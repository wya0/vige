# Vige é¡¹ç›®å¼€å‘è§„åˆ™

## ğŸ“‹ ç›®å½•ç´¢å¼•
- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [åç«¯å¼€å‘è§„èŒƒ](#åç«¯å¼€å‘è§„èŒƒ)
- [å‰ç«¯å¼€å‘è§„èŒƒ](#å‰ç«¯å¼€å‘è§„èŒƒ)
- [ä»£ç ç¤ºä¾‹æ¨¡æ¿](#ä»£ç ç¤ºä¾‹æ¨¡æ¿)
- [å¼€å‘æ³¨æ„äº‹é¡¹](#å¼€å‘æ³¨æ„äº‹é¡¹)
- [ç¦æ­¢äº‹é¡¹](#ç¦æ­¢äº‹é¡¹)
- [æ¨èåšæ³•](#æ¨èåšæ³•)
- [æ–‡ä»¶å‘½åè§„èŒƒ](#æ–‡ä»¶å‘½åè§„èŒƒ)
- [æ³¨é‡Šè§„èŒƒ](#æ³¨é‡Šè§„èŒƒ)

---

## é¡¹ç›®æ¦‚è¿°
Vige æ˜¯ä¸€ä¸ª FastAPI + Vue çš„å…¨æ ˆå·¥ç¨‹æ¨¡æ¿ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š
- **vige-api**: åç«¯ API æœåŠ¡ (FastAPI + SQLAlchemy + PostgreSQL + Redis + Huey)
- **vige-bo**: åå°ç®¡ç†ç³»ç»Ÿ (Vue 2 + iView)
- **vige-web**: å‰ç«¯ç”¨æˆ·ç½‘ç«™ (Vue 2 + iView)
- **vige-wechat**: å¾®ä¿¡ H5 å®¢æˆ·ç«¯ (Vue 2 + Mint UI)

å®šä½ï¼šé€šç”¨å‹ Web æ¡†æ¶è„šæ‰‹æ¶ï¼Œæä¾›è®¤è¯ã€ä»»åŠ¡é˜Ÿåˆ—ã€åª’ä½“ä¸Šä¼ ã€å›½é™…åŒ–ä¸ç»Ÿä¸€æ¥å£è§„èŒƒï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ã€‚

## åç«¯å¼€å‘è§„èŒƒ (vige-api)

### æŠ€æœ¯æ ˆ
- Webæ¡†æ¶: FastAPI
- ORM: SQLAlchemy 2.0 (æ–°å¼ç±»å‹æ³¨è§£)
- æ•°æ®åº“: PostgreSQL + Redis
- è®¤è¯: JWT + Cookie + CSRF
- ä»»åŠ¡é˜Ÿåˆ—: Huey + Redis
- é…ç½®ç®¡ç†: Pydantic Settings

### Pydantic 2.x å…¼å®¹æ€§è§„èŒƒ âš ï¸ æå…¶é‡è¦

#### æ ¸å¿ƒå˜æ›´è¯´æ˜ï¼š
é¡¹ç›®ä½¿ç”¨ Pydantic 2.x ç‰ˆæœ¬ï¼ŒæŸäº›è¯­æ³•å·²å‘ç”Ÿå˜æ›´ï¼Œå¿…é¡»ä¸¥æ ¼éµå¾ªæ–°ç‰ˆæœ¬è§„èŒƒã€‚

#### å­—æ®µéªŒè¯å‚æ•°å˜æ›´ï¼š
```python
# âŒ é”™è¯¯ï¼šPydantic 1.x è¯­æ³•ï¼Œä¼šå¯¼è‡´ PydanticUserError
class UserForm(BaseModel):
    mobile: str = Field(..., description="æ‰‹æœºå·ç ", regex="^1[3-9]\d{9}$")

# âœ… æ­£ç¡®ï¼šPydantic 2.x è¯­æ³•
class UserForm(BaseModel):
    mobile: str = Field(..., description="æ‰‹æœºå·ç ", pattern="^1[3-9]\d{9}$")
```

#### é…ç½®ç±»å‚æ•°å˜æ›´ï¼š
```python
# âŒ é”™è¯¯ï¼šPydantic 1.x è¯­æ³•ï¼Œä¼šäº§ç”Ÿç”¨æˆ·è­¦å‘Š
class UserForm(BaseModel):
    username: str = Field(...)
    
    class Config:
        schema_extra = {
            "example": {
                "username": "example"
            }
        }

# âœ… æ­£ç¡®ï¼šPydantic 2.x è¯­æ³•
class UserForm(BaseModel):
    username: str = Field(...)
    
    class Config:
        json_schema_extra = {
            "example": {
                "username": "example"
            }
        }
```

#### å¸¸è§å…¼å®¹æ€§é—®é¢˜å¯¹ç…§è¡¨ï¼š
```python
# Pydantic 1.x â†’ Pydantic 2.x
regex="pattern"          â†’ pattern="pattern"
schema_extra             â†’ json_schema_extra
allow_reuse=True         â†’ å·²ç§»é™¤ï¼Œæ— éœ€è®¾ç½®
min_length               â†’ min_length (ä¿æŒä¸å˜)
max_length               â†’ max_length (ä¿æŒä¸å˜)
gt, ge, lt, le          â†’ gt, ge, lt, le (ä¿æŒä¸å˜)
```

#### éªŒè¯è£…é¥°å™¨ä½¿ç”¨ï¼š
```python
# âœ… æ­£ç¡®ï¼šç»§ç»­ä½¿ç”¨ field_validatorï¼Œä½†æ³¨æ„å‚æ•°å˜åŒ–
from pydantic import field_validator

class UserForm(BaseModel):
    mobile: str = Field(..., pattern="^1[3-9]\d{9}$")
    
    @field_validator('mobile')
    @classmethod
    def validate_mobile(cls, v):
        if not v:
            raise ValueError('æ‰‹æœºå·ä¸ºå¿…å¡«é¡¹')
        return v
```

#### é‡è¦æ³¨æ„äº‹é¡¹ï¼š
1. **ä¸¥ç¦ä½¿ç”¨ `regex`**ï¼šå¿…é¡»ä½¿ç”¨ `pattern` æ›¿ä»£
2. **é…ç½®ç±»æ›´æ–°**ï¼šä½¿ç”¨ `json_schema_extra` è€Œä¸æ˜¯ `schema_extra`
3. **ç«‹å³ä¿®å¤**ï¼šé‡åˆ° PydanticUserError æˆ–ç›¸å…³è­¦å‘Šç«‹å³æŒ‰è§„èŒƒä¿®å¤
4. **å›¢é˜Ÿç»Ÿä¸€**ï¼šæ‰€æœ‰å¼€å‘è€…éƒ½å¿…é¡»éµå¾ª Pydantic 2.x è¯­æ³•
5. **æ£€æŸ¥æ¸…å•**ï¼šæ¯æ¬¡åˆ›å»ºè¡¨å•ç±»éƒ½è¦æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„è¯­æ³•

#### é”™è¯¯ä¿¡æ¯è¯†åˆ«ï¼š
- **`PydanticUserError: 'regex' is removed. use 'pattern' instead`** â†’ å°† `regex` æ”¹ä¸º `pattern`
- **`Valid config keys have changed in V2: 'schema_extra' has been renamed to 'json_schema_extra'`** â†’ å°† `schema_extra` æ”¹ä¸º `json_schema_extra`

#### æ ‡å‡†è¡¨å•æ¨¡æ¿ï¼š
```python
from pydantic import BaseModel, Field
from typing import Optional

class StandardForm(BaseModel):
    """æ ‡å‡†è¡¨å•æ¨¡æ¿"""
    mobile: str = Field(..., pattern="^1[3-9]\d{9}$")
    username: str = Field(..., min_length=3, max_length=50)
    age: Optional[int] = Field(None, ge=0, le=120)
```

### ä»£ç é£æ ¼
- ç±»å: PascalCase (å¦‚ User, MediaModel)
- å‡½æ•°/å˜é‡å: snake_case (å¦‚ send_validation_code, user_id)
- å¸¸é‡: UPPER_CASE (å¦‚ AUTHJWT_SECRET_KEY)
- æ•°æ®åº“å­—æ®µ: snake_case

### æ•°æ®åº“æ“ä½œæ ¸å¿ƒåŸåˆ™ âš ï¸ æå…¶é‡è¦

#### åŸºç¡€åŸåˆ™ï¼š
1. **åªè¯»æŸ¥è¯¢**: ä½¿ç”¨ `db: Session = Depends(sm.get_db)` ä¾èµ–æ³¨å…¥
2. **æ•°æ®å˜æ›´**: ä½¿ç”¨ `with sm.transaction_scope() as sa:` äº‹åŠ¡ä¸Šä¸‹æ–‡
3. **ç”¨æˆ·è®¤è¯**: å§‹ç»ˆä½¿ç”¨ `user: User = Depends(get_user)` è¿›è¡Œ JWT éªŒè¯
4. **ç¦æ­¢æ··ç”¨**: ä¸è¦åœ¨åŒä¸€å‡½æ•°ä¸­åŒæ—¶ä½¿ç”¨ä¸¤ç§æ•°æ®åº“ä¸Šä¸‹æ–‡

#### Sessionå¯¹è±¡ç®¡ç†è§„èŒƒ âš ï¸ æå…¶é‡è¦æ ¸å¿ƒåŸåˆ™ï¼š

**å…³é”®åŸåˆ™ï¼šä¸åŒsessionä¸­çš„å¯¹è±¡ä¸èƒ½ç›¸äº’æ“ä½œï¼**

1. **sessionéš”ç¦»åŸåˆ™**ï¼š
   - `current_user: User = Depends(get_user)` è·å–çš„å¯¹è±¡å±äºä¾èµ–æ³¨å…¥çš„session
   - `with sm.transaction_scope() as sa:` åˆ›å»ºçš„æ˜¯æ–°çš„ç‹¬ç«‹session
   - **ç»å¯¹ç¦æ­¢**åœ¨æ–°sessionä¸­ç›´æ¥ä¿®æ”¹å…¶ä»–sessionçš„å¯¹è±¡

2. **æ­£ç¡®çš„å¯¹è±¡ä¿®æ”¹æ–¹å¼**ï¼š
```python
# âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹å…¶ä»–sessionçš„å¯¹è±¡
@mp_required
async def update_user(form: UpdateForm, current_user: User = Depends(get_user)):
    with sm.transaction_scope() as sa:
        # é”™è¯¯ï¼current_userå±äºå¦ä¸€ä¸ªsessionï¼Œä¸èƒ½åœ¨æ–°sessionä¸­ä¿®æ”¹
        current_user.nickname = form.nickname  
        current_user.updated_at = datetime.utcnow()

# âœ… æ­£ç¡®ï¼šåœ¨æ–°sessionä¸­é‡æ–°è·å–å¯¹è±¡å†ä¿®æ”¹
@mp_required
async def update_user(form: UpdateForm, current_user: User = Depends(get_user)):
    with sm.transaction_scope() as sa:
        # æ­£ç¡®ï¼šåœ¨æ–°sessionä¸­é‡æ–°è·å–ç”¨æˆ·å¯¹è±¡
        user = User.get_or_404(sa, current_user.id)
        user.nickname = form.nickname
        user.updated_at = datetime.utcnow()
```

3. **æ ¸å¿ƒè¦ç‚¹**ï¼š
   - **é‡æ–°è·å–å¯¹è±¡**ï¼šåœ¨äº‹åŠ¡sessionä¸­å¿…é¡»ä½¿ç”¨ `Model.get_or_404(sa, id)` é‡æ–°è·å–
   - **IDä¼ é€’**ï¼šå¯ä»¥ä½¿ç”¨ `current_user.id` è·å–IDï¼Œä½†ä¸èƒ½ç›´æ¥æ“ä½œå¯¹è±¡
   - **sessionå½’å±**ï¼šæ¯ä¸ªæ•°æ®åº“å¯¹è±¡åªèƒ½åœ¨å…¶æ‰€å±çš„sessionä¸­è¢«ä¿®æ”¹
   - **äº‹åŠ¡å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰ç›¸å…³æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªäº‹åŠ¡sessionä¸­å®Œæˆ

4. **å¸¸è§é”™è¯¯æ¨¡å¼**ï¼š
```python
# âŒ é”™è¯¯æ¨¡å¼1ï¼šç›´æ¥ä¿®æ”¹ä¾èµ–æ³¨å…¥å¯¹è±¡
with sm.transaction_scope() as sa:
    current_user.field = new_value  # é”™è¯¯ï¼

# âŒ é”™è¯¯æ¨¡å¼2ï¼šæ··ç”¨ä¸åŒsessionçš„å¯¹è±¡
with sm.transaction_scope() as sa:
    other_user.field = new_value  # é”™è¯¯ï¼
    current_user.related_id = other_user.id  # é”™è¯¯ï¼

# âœ… æ­£ç¡®æ¨¡å¼ï¼šç»Ÿä¸€åœ¨æ–°sessionä¸­æ“ä½œ
with sm.transaction_scope() as sa:
    user = User.get_or_404(sa, current_user.id)
    other = OtherModel.get_or_404(sa, other_id)
    user.field = new_value
    user.related_id = other.id
```

5. **æ£€æŸ¥æ¸…å•**ï¼š
   - âœ… åœ¨äº‹åŠ¡ä¸­é‡æ–°è·å–éœ€è¦ä¿®æ”¹çš„å¯¹è±¡
   - âœ… ä½¿ç”¨å¯¹è±¡IDè¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ç›´æ¥æ“ä½œä¾èµ–æ³¨å…¥çš„å¯¹è±¡
   - âœ… æ‰€æœ‰ç›¸å…³å¯¹è±¡éƒ½åœ¨åŒä¸€ä¸ªäº‹åŠ¡sessionä¸­è·å–å’Œæ“ä½œ
   - âŒ ä¸åœ¨æ–°sessionä¸­ç›´æ¥ä¿®æ”¹current_userç­‰ä¾èµ–æ³¨å…¥å¯¹è±¡
   - âŒ ä¸æ··ç”¨æ¥è‡ªä¸åŒsessionçš„å¯¹è±¡

### API è·¯ç”±è®¾è®¡ï¼ˆä¸å½“å‰é¡¹ç›®ä¸€è‡´ï¼‰
- API åŸºç¡€å‰ç¼€ä¸º `/v1`
- ç«¯å‰ç¼€åŒºåˆ†: `/admin/*`ï¼ˆåå°ç®¡ç†ï¼‰, `/web/*`ï¼ˆWeb ç«¯ï¼‰, `/wechat/*`ï¼ˆå¾®ä¿¡ç«¯ï¼‰
- éªŒè¯è£…é¥°å™¨ï¼ˆé¡¹ç›®å·²æœ‰å®ç°ï¼‰ï¼š`@user_required`ï¼ˆä»…å…è®¸ Web æºï¼‰ã€`@bo_required`ï¼ˆä»…å…è®¸ BO æºï¼‰ã€`@login_required`ï¼ˆä»»ä¸€å—ä¿¡æºï¼‰
- ç»Ÿä¸€å“åº”æ ¼å¼ï¼šæˆåŠŸ `{ success: true, data: ... }`ï¼›é”™è¯¯ `{ success: false, message: ... }` æˆ–ä½¿ç”¨ `HTTPException(detail)` ç”±æ‹¦æˆªå™¨å±•ç¤º

### RESTful API è®¾è®¡è§„èŒƒï¼ˆä¿ç•™ä½†æŒ‰é¡¹ç›®å®ç°ç®€åŒ–ï¼‰

#### æ ¸å¿ƒåŸåˆ™ï¼š
ä¸¥æ ¼éµå¾ªRESTful APIè®¾è®¡è§„èŒƒï¼Œä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•å’Œèµ„æºå‘½åã€‚

#### HTTPæ–¹æ³•ä½¿ç”¨è§„èŒƒï¼š
```python
# âœ… æ­£ç¡®ï¼šRESTful APIè®¾è®¡
POST   /web/translations           # åˆ›å»ºæ–°çš„ç¿»è¯‘ä»»åŠ¡
GET    /web/translations           # è·å–ç¿»è¯‘ä»»åŠ¡åˆ—è¡¨
GET    /web/translations/{task_id}  # è·å–å•ä¸ªç¿»è¯‘ä»»åŠ¡è¯¦æƒ…
PUT    /web/translations/{task_id}  # æ›´æ–°ç¿»è¯‘ä»»åŠ¡ä¿¡æ¯
DELETE /web/translations/{task_id}  # åˆ é™¤ç¿»è¯‘ä»»åŠ¡è®°å½•

POST   /web/users          # åˆ›å»ºç”¨æˆ·
GET    /web/users          # è·å–ç”¨æˆ·åˆ—è¡¨  
GET    /web/users/{user_id} # è·å–å•ä¸ªç”¨æˆ·
PUT    /web/users/{user_id} # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
DELETE /web/users/{user_id} # åˆ é™¤ç”¨æˆ·
```

#### èµ„æºå‘½åè§„èŒƒï¼š
1. **ä½¿ç”¨å¤æ•°åè¯**ï¼š`/users`ã€`/asks`ã€`/products`
2. **é¿å…åŠ¨è¯**ï¼šä¸ä½¿ç”¨ `/search-experts`ã€`/create-user` ç­‰åŠ¨è¯å½¢å¼
3. **åµŒå¥—èµ„æº**ï¼š`/users/{user_id}/posts`ã€`/asks/{ask_id}/results`
4. **æŸ¥è¯¢å‚æ•°**ï¼šä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿›è¡Œè¿‡æ»¤ã€æ’åºã€åˆ†é¡µ

#### æ­£ç¡®ç¤ºä¾‹ï¼š
```python
# âœ… æ­£ç¡®ï¼šRESTfulè®¾è®¡
@app.post('/web/translations',           # åˆ›å»ºç¿»è¯‘ä»»åŠ¡
          summary="åˆ›å»ºç¿»è¯‘ä»»åŠ¡")
@app.get('/web/translations',            # è·å–ç¿»è¯‘åˆ—è¡¨
         summary="è·å–ç¿»è¯‘å†å²")
@app.get('/web/translations/{task_id}',   # è·å–å•ä¸ªç¿»è¯‘ä»»åŠ¡
         summary="è·å–ç¿»è¯‘è¯¦æƒ…")
@app.put('/web/translations/{task_id}',   # æ›´æ–°ç¿»è¯‘ä»»åŠ¡
         summary="æ›´æ–°ç¿»è¯‘ä¿¡æ¯")
@app.delete('/web/translations/{task_id}', # åˆ é™¤ç¿»è¯‘ä»»åŠ¡
            summary="åˆ é™¤ç¿»è¯‘è®°å½•")
```

æ³¨ï¼šé¡¹ç›®éƒ¨åˆ†æ¥å£å·²å­˜åœ¨å†å²è·¯å¾„ï¼ˆå¦‚ `/admin/users/<int:user_id>` é£æ ¼ï¼‰ï¼Œé€æ­¥æ¼”è¿›å³å¯ï¼Œæ— éœ€ä¸€æ¬¡æ€§é‡æ„ã€‚

#### ç‰¹æ®Šæ“ä½œå¤„ç†ï¼š
å¯¹äºä¸èƒ½ç”¨æ ‡å‡†CRUDè¡¨ç¤ºçš„æ“ä½œï¼Œä½¿ç”¨å­èµ„æºæˆ–åŠ¨ä½œï¼š
```python
# ç¿»è¯‘æ“ä½œä½œä¸ºåˆ›å»ºç¿»è¯‘ä»»åŠ¡çš„ä¸€éƒ¨åˆ†
POST /web/translations  # åˆ›å»ºç¿»è¯‘ä»»åŠ¡å¹¶æ‰§è¡Œç¿»è¯‘

# å¦‚æœéœ€è¦å•ç‹¬çš„ç¿»è¯‘ç«¯ç‚¹
POST /web/translations/{task_id}/retry  # é‡æ–°ç¿»è¯‘

# æ‰¹é‡æ“ä½œ
POST /web/translations/batch-delete  # æ‰¹é‡åˆ é™¤
PUT  /web/translations/batch-update   # æ‰¹é‡æ›´æ–°
```

#### RESTfulè®¾è®¡æ£€æŸ¥æ¸…å•ï¼š
- âœ… ä½¿ç”¨å¤æ•°åè¯ä½œä¸ºèµ„æºå
- âœ… ä½¿ç”¨æ­£ç¡®çš„HTTPæ–¹æ³•
- âœ… è¿”å›åˆé€‚çš„HTTPçŠ¶æ€ç 
- âœ… ä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿›è¡Œè¿‡æ»¤
- âœ… åµŒå¥—èµ„æºè¡¨ç¤ºå…³ç³»
- âŒ ä¸åœ¨URLä¸­ä½¿ç”¨åŠ¨è¯
- âŒ ä¸ä½¿ç”¨éæ ‡å‡†çš„HTTPæ–¹æ³•
- âŒ ä¸è¿”å›é”™è¯¯çš„çŠ¶æ€ç 

### API å“åº”æ ¼å¼è§„èŒƒ

#### æ ¸å¿ƒåŸåˆ™ï¼š
**æ‰€æœ‰APIæ¥å£å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„ `data` åŒ…è£…æ ¼å¼ï¼Œç¡®ä¿å“åº”ç»“æ„çš„ä¸€è‡´æ€§å’Œæ‰©å±•æ€§**

#### æ ‡å‡†å“åº”æ ¼å¼ï¼š
```python
# âœ… æ­£ç¡®ï¼šç®€å•æ•°æ®è¿”å›ï¼Œä½¿ç”¨dataåŒ…è£…
return dict(
    success=True,
    data=user.dump()
)

# âœ… æ­£ç¡®ï¼šå¤æ‚æ•°æ®è¿”å›ï¼Œdataä¸­åŒ…å«å¤šä¸ªå­—æ®µ
return dict(
    success=True,
    data={
        "teachers": [...],
        "pagination": {...},
        "filters": {...},
        "metadata": {...}
    }
)

# âœ… æ­£ç¡®ï¼šåˆ—è¡¨/åˆ†é¡µæ“ä½œè¿”å›æ ¼å¼
return dict(
    success=True,
    data={
        "rows": items,
        "total": total_count,
        "page": page,
        "per_page": per_page
    }
)

# âœ… æ­£ç¡®ï¼šåˆ›å»ºæ“ä½œè¿”å›æ–°å¯¹è±¡
return dict(
    success=True,
    data={
        "user": user.dump(),
        "token": access_token
    }
)

# âŒ é”™è¯¯ï¼šå­—æ®µå¹³é“ºï¼Œä¸ä½¿ç”¨dataåŒ…è£…
return dict(
    success=True,
    user=user.dump(),          # é”™è¯¯ï¼šåº”è¯¥æ”¾åœ¨dataä¸­
    token=access_token         # é”™è¯¯ï¼šåº”è¯¥æ”¾åœ¨dataä¸­
)

# âŒ é”™è¯¯ï¼šåœ¨æˆåŠŸå“åº”ä¸­æ·»åŠ ä¸å¿…è¦çš„messageå­—æ®µ
return dict(
    success=True,
    data=result_data,
    message="æ“ä½œæˆåŠŸ"  # å¤šä½™ï¼ŒæˆåŠŸæ“ä½œä¸éœ€è¦message
)
```

#### ä½¿ç”¨è§„èŒƒï¼š
1. **ç»Ÿä¸€åŒ…è£…**ï¼šæ‰€æœ‰ä¸šåŠ¡æ•°æ®å¿…é¡»åŒ…è£…åœ¨ `data` å­—æ®µä¸­
2. **æ ¹çº§å­—æ®µ**ï¼šæ ¹çº§åˆ«åªä¿ç•™ `success`ã€`message`ï¼ˆé”™è¯¯æ—¶ï¼‰ç­‰ç³»ç»Ÿå­—æ®µ
3. **æˆåŠŸå“åº”**ï¼šåªè¿”å› `success=True` å’Œ `data`ï¼Œä¸è¦æ·»åŠ  `message`
4. **é”™è¯¯å“åº”**ï¼šä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å¤„ç†å‡½æ•°ï¼Œä¼šè‡ªåŠ¨åŒ…å«åˆé€‚çš„é”™è¯¯ä¿¡æ¯
5. **ä¿æŒä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ¥å£éƒ½éµå¾ªç›¸åŒçš„è¿”å›æ ¼å¼
6. **æ‰©å±•æ€§å¼º**ï¼šå¯ä»¥åœ¨dataä¸­æ·»åŠ ä»»ä½•ä¸šåŠ¡ç›¸å…³å­—æ®µè€Œä¸ä¼šä¸ç³»ç»Ÿå­—æ®µå†²çª

### æƒé™éªŒè¯å’Œæ¥æºæ£€æŸ¥è§„èŒƒ â­ æå…¶é‡è¦

#### æ ¸å¿ƒåŸåˆ™ï¼š
ä¸åŒç±»å‹çš„æ¥å£å¿…é¡»ä½¿ç”¨å¯¹åº”çš„éªŒè¯è£…é¥°å™¨ï¼Œç¡®ä¿è¯·æ±‚æ¥æºçš„åˆæ³•æ€§å’Œå®‰å…¨æ€§ã€‚

#### éªŒè¯è£…é¥°å™¨ä½¿ç”¨è§„èŒƒï¼š
```python
# Webç«¯æ¥å£ä½¿ç”¨ @user_required  
@app.post('/web/translations')
@user_required
async def create_translation():
    pass

# åå°ç®¡ç†æ¥å£ä½¿ç”¨ @bo_required
@app.post('/admin/users')
@bo_required
async def admin_create_user():
    pass

# å¾®ä¿¡ç«¯æ¥å£ä½¿ç”¨ @wechat_required
@app.post('/wechat/translate')
@wechat_required
async def wechat_translate():
    pass
```

#### éªŒè¯è£…é¥°å™¨å¯¹åº”å…³ç³»ï¼š
- **Webç«¯æ¥å£** (`/web/*`) â†’ `@user_required` - éªŒè¯Webç«¯ç”¨æˆ·èº«ä»½
- **åå°ç®¡ç†æ¥å£** (`/admin/*`) â†’ `@bo_required` - éªŒè¯åå°ç®¡ç†å‘˜èº«ä»½å’Œæƒé™
- **å¾®ä¿¡ç«¯æ¥å£** (`/wechat/*`) â†’ `@wechat_required` - éªŒè¯å¾®ä¿¡ç«¯ç”¨æˆ·èº«ä»½

#### é‡è¦æ³¨æ„äº‹é¡¹ï¼š
1. **ä¸¥æ ¼å¯¹åº”**ï¼šæ¥å£å‰ç¼€å¿…é¡»ä¸éªŒè¯è£…é¥°å™¨ä¸¥æ ¼å¯¹åº”
2. **æ¥æºéªŒè¯**ï¼šè£…é¥°å™¨ä¼šéªŒè¯è¯·æ±‚æ¥æºæ˜¯å¦åˆæ³•
3. **ç”¨æˆ·èº«ä»½**ï¼šåŒæ—¶éªŒè¯ç”¨æˆ·çš„èº«ä»½å’Œæƒé™
4. **å®‰å…¨æ€§**ï¼šé˜²æ­¢è·¨ç«¯è®¿é—®å’Œéæ³•è¯·æ±‚

### æ ‡å‡†åŒ–é”™è¯¯å¤„ç†è§„èŒƒ â­ æå…¶é‡è¦

#### æ ¸å¿ƒåŸåˆ™ï¼š
1. **ç»Ÿä¸€é”™è¯¯æ ¼å¼**ï¼šæ‰€æœ‰é”™è¯¯éƒ½ä½¿ç”¨æ ‡å‡†åŒ–çš„å“åº”æ ¼å¼
2. **æ ‡å‡†HTTPçŠ¶æ€ç **ï¼šæ­£ç¡®ä½¿ç”¨HTTPçŠ¶æ€ç è¡¨ç¤ºä¸åŒç±»å‹çš„é”™è¯¯
3. **é”™è¯¯ç æ ‡è¯†**ï¼šä¸ºç¨‹åºåŒ–å¤„ç†æä¾›æ˜ç¡®çš„é”™è¯¯ä»£ç 
4. **ç”¨æˆ·å‹å¥½ä¿¡æ¯**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯æè¿°ä¿¡æ¯

#### æ ‡å‡†é”™è¯¯å“åº”æ ¼å¼ï¼š
```python
# åŸºç¡€é”™è¯¯æ ¼å¼
{
    "success": false,
    "message": "ç”¨æˆ·å‹å¥½çš„é”™è¯¯æè¿°",
    "error_code": "ERROR_CODE",  # å¯é€‰
    "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"     # å¯é€‰
}

# è¡¨å•éªŒè¯é”™è¯¯æ ¼å¼
{
    "success": false,
    "message": "è¡¨å•éªŒè¯å¤±è´¥",
    "errors": [
        {
            "field": "username",
            "message": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º"
        }
    ]
}
```

#### HTTPçŠ¶æ€ç ä½¿ç”¨è§„èŒƒï¼š
- **200**: è¯·æ±‚æˆåŠŸ - æ­£å¸¸ä¸šåŠ¡æ“ä½œ
- **400**: è¯·æ±‚å‚æ•°é”™è¯¯ - å‚æ•°éªŒè¯å¤±è´¥ã€ä¸šåŠ¡é€»è¾‘é”™è¯¯
- **401**: æœªæˆæƒè®¿é—® - æœªç™»å½•ã€ä»¤ç‰Œè¿‡æœŸã€å¯†ç é”™è¯¯
- **403**: æƒé™ä¸è¶³ - æ— ç›¸åº”æƒé™ã€è§’è‰²é™åˆ¶
- **404**: èµ„æºä¸å­˜åœ¨ - ç”¨æˆ·ä¸å­˜åœ¨ã€æ¥å£ä¸å­˜åœ¨
- **422**: æ•°æ®éªŒè¯é”™è¯¯ - Pydanticè¡¨å•éªŒè¯å¤±è´¥
- **500**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ - ç³»ç»Ÿå¼‚å¸¸ã€æ•°æ®åº“é”™è¯¯

#### æ ‡å‡†é”™è¯¯ä»£ç åˆ†ç±»ï¼š
```python
# è®¤è¯ç›¸å…³ (401)
NOT_AUTHENTICATED       # ç”¨æˆ·æœªç™»å½•
TOKEN_INVALID          # JWTä»¤ç‰Œæ— æ•ˆæˆ–è¿‡æœŸ
INVALID_CREDENTIALS    # ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

# æƒé™ç›¸å…³ (403)
INSUFFICIENT_PERMISSION # æƒé™ä¸è¶³
ROLE_RESTRICTION       # è§’è‰²æƒé™é™åˆ¶
RESOURCE_FORBIDDEN     # èµ„æºè®¿é—®é™åˆ¶

# ä¸šåŠ¡é€»è¾‘ (400)
INVALID_PARAMETER      # è¯·æ±‚å‚æ•°é”™è¯¯
USER_INACTIVE          # ç”¨æˆ·æœªæ¿€æ´»
DUPLICATE_RESOURCE     # èµ„æºé‡å¤
BUSINESS_RULE_VIOLATION # ä¸šåŠ¡è§„åˆ™å†²çª

# èµ„æºç›¸å…³ (404)
USER_NOT_FOUND         # ç”¨æˆ·ä¸å­˜åœ¨
RESOURCE_NOT_FOUND     # èµ„æºä¸å­˜åœ¨
API_NOT_FOUND          # APIæ¥å£ä¸å­˜åœ¨

# ç³»ç»Ÿé”™è¯¯ (500)
INTERNAL_ERROR         # æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
DATABASE_ERROR         # æ•°æ®åº“é”™è¯¯
EXTERNAL_SERVICE_ERROR # å¤–éƒ¨æœåŠ¡é”™è¯¯
```

#### é”™è¯¯å¤„ç†å·¥å…·å‡½æ•°ä½¿ç”¨è§„èŒƒï¼š
```python
# å¿…é¡»å¯¼å…¥å’Œä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å‡½æ•°
from ..utils import (
    raise_http_error,           # é€šç”¨é”™è¯¯æŠ›å‡º
    raise_bad_request,          # 400é”™è¯¯
    raise_unauthorized,         # 401é”™è¯¯  
    raise_forbidden,            # 403é”™è¯¯
    raise_not_found,            # 404é”™è¯¯
    raise_validation_error,     # 422é”™è¯¯
    raise_internal_error,       # 500é”™è¯¯
    # ä¸šåŠ¡é€»è¾‘å¿«æ·å‡½æ•°
    raise_user_not_found,       # ç”¨æˆ·ä¸å­˜åœ¨
    raise_invalid_credentials,  # è®¤è¯å¤±è´¥
    raise_user_inactive,        # ç”¨æˆ·æœªæ¿€æ´»
    raise_duplicate_username,   # ç”¨æˆ·åé‡å¤
    raise_role_not_found,       # è§’è‰²ä¸å­˜åœ¨
    raise_permission_denied,    # æƒé™ä¸è¶³
)
```

è¯´æ˜ï¼šæœ¬é¡¹ç›®å®é™…åŒæ—¶ä½¿ç”¨ `dict(success=..., ...)` ä¸ `HTTPException` ä¸¤ç§å½¢å¼ï¼Œå‰ç«¯æ‹¦æˆªå™¨å·²åšå…¼å®¹ï¼›ä¿æŒä¸€è‡´æ€§å³å¯ï¼Œåç»­é€æ­¥ç»Ÿä¸€ä¸ºæˆåŠŸ `{ success, data }`ã€å¤±è´¥ `{ success=false, message }`ã€‚

#### APIæ–‡æ¡£ä¸­çš„é”™è¯¯å“åº”é…ç½®ï¼š
```python
@router.post('/admin/login')
async def login(...):
    pass
```

#### è‡ªå®šä¹‰é”™è¯¯å¤„ç†ï¼š
```python
# å½“éœ€è¦ç‰¹æ®Šé”™è¯¯æ—¶ï¼Œä½¿ç”¨ raise_http_error
def validate_business_rule(data):
    if some_complex_validation_fails:
        raise_http_error(
            status_code=400,
            message="ä¸šåŠ¡è§„åˆ™éªŒè¯å¤±è´¥ï¼šè®¢å•çŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œ",
            error_code="ORDER_STATUS_CONFLICT",
            details={"current_status": "completed", "required_status": "pending"}
        )
```

#### é”™è¯¯å¤„ç†åŸåˆ™ï¼š
1. **ä¼˜å…ˆä½¿ç”¨å·¥å…·å‡½æ•°**ï¼šä½¿ç”¨é¢„å®šä¹‰çš„é”™è¯¯å‡½æ•°è€Œä¸æ˜¯ç›´æ¥æŠ›HTTPException
2. **æ­£ç¡®çš„çŠ¶æ€ç **ï¼šç¡®ä¿HTTPçŠ¶æ€ç ä¸é”™è¯¯ç±»å‹åŒ¹é…
3. **æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯**ï¼šæä¾›ç”¨æˆ·å‹å¥½çš„ä¸­æ–‡é”™è¯¯æè¿°
4. **é”™è¯¯ç ä¸€è‡´æ€§**ï¼šç›¸åŒç±»å‹çš„é”™è¯¯ä½¿ç”¨ç›¸åŒçš„é”™è¯¯ä»£ç 
5. **æ–‡æ¡£å®Œæ•´æ€§**ï¼šAPIæ–‡æ¡£ä¸­å¿…é¡»åŒ…å«é”™è¯¯å“åº”ç¤ºä¾‹
6. **æ—¥å¿—è®°å½•**ï¼šé‡è¦é”™è¯¯éœ€è¦è®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯

#### é”™è¯¯å¤„ç†æ£€æŸ¥æ¸…å•ï¼š
- âœ… ä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å‡½æ•°
- âœ… HTTPçŠ¶æ€ç æ­£ç¡®
- âœ… åŒ…å« STANDARD_ERROR_RESPONSES
- âœ… é”™è¯¯ä¿¡æ¯ç”¨æˆ·å‹å¥½
- âœ… é”™è¯¯ç ç¬¦åˆè§„èŒƒ
- âŒ ä¸ä½¿ç”¨ç›´æ¥çš„ HTTPException
- âŒ ä¸ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯æ ¼å¼
- âŒ ä¸æ··ç”¨çŠ¶æ€ç 



### è¡¨å•éªŒè¯å’Œå‚æ•°å¤„ç†è§„èŒƒï¼ˆç»“åˆé¡¹ç›®ç°çŠ¶ï¼‰

#### æ ¸å¿ƒåŸåˆ™ï¼š
ä¼˜å…ˆä½¿ç”¨ Pydantic 2.x è¡¨å•è¿›è¡ŒéªŒè¯ä¸æ–‡æ¡£ç”Ÿæˆï¼›GET åœºæ™¯å¯è§†å¤æ‚åº¦é€‰æ‹© `Depends()` è¡¨å•æˆ–ç®€æ´çš„ Query å‚æ•°ï¼Œä¿æŒæ˜“è¯»ä¸ä¸€è‡´æ€§ã€‚

#### å»ºè®®ï¼š
- POST æ¥å£ä½¿ç”¨è¡¨å•æ¨¡å‹æ¥æ”¶è¯·æ±‚ä½“
- GET æ¥å£ä¼˜å…ˆè¡¨å•ä¾èµ–ï¼›è‹¥å‚æ•°æå°‘å¯ç›´æ¥ä½¿ç”¨ Query å‚æ•°
- å‚æ•°é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»Ÿä¸€éªŒè¯ä¸ç”Ÿæˆæ–‡æ¡£

ï¼ˆç§»é™¤ä¸æœ¬é¡¹ç›®æ— å…³çš„ `mp` ç¤ºä¾‹ï¼‰

ï¼ˆç§»é™¤ä¸æœ¬é¡¹ç›®æ— å…³çš„åä¾‹æ®µè½ï¼‰

#### è¡¨å•è®¾è®¡åŸåˆ™ï¼š
- **æ‰€æœ‰APIæ¥å£éƒ½å¿…é¡»ä½¿ç”¨è¡¨å•éªŒè¯**
- **Filter Form**ï¼šç”¨äºæŸ¥è¯¢å’Œåˆ†é¡µï¼Œç»§æ‰¿ `BaseFilterForm`
- **Edit Form**ï¼šç”¨äºåˆ›å»ºå’Œç¼–è¾‘ï¼ŒCreate å’Œ Update å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¡¨å•
- **å‚æ•°é›†ä¸­**ï¼šç›¸å…³å‚æ•°ç»„ç»‡åˆ°åŒä¸€ä¸ªè¡¨å•ç±»ä¸­
- **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ Pydantic æä¾›ç±»å‹æ£€æŸ¥å’Œè‡ªåŠ¨è½¬æ¢
- **æ–‡æ¡£å®Œæ•´**ï¼šè¡¨å•å­—æ®µè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ API æ–‡æ¡£

#### Filter Form è§„èŒƒï¼š
```python
from ..forms import BaseFilterForm

class GenerationRequestFilterForm(BaseFilterForm):
    product_id: Optional[int] = None
    status: Optional[str] = None
    
    # BaseFilterForm å·²åŒ…å«ï¼š
    # keyword: Optional[str] = None  # å…³é”®è¯è¿‡æ»¤
    # page: Optional[int] = 1        # é¡µç 
    # per_page: Optional[int] = 10   # æ¯é¡µæ•°é‡
```

#### Edit Form è§„èŒƒï¼š
```python
class GenerationRequestForm(BaseModel):
    product_id: int
    prompt: str
    size: str = OpenAIImageSize.SQUARE.value
    style: str = OpenAIImageStyle.VIVID.value
    image_count: int = 1
```

#### åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ CRUDMixinï¼š
```python
@router.get('/web/ai/generation-history')
@user_required
async def get_generation_history(
    form: GenerationRequestFilterForm = Depends(),
    db: Session = Depends(sm.get_db),
    current_user: User = Depends(get_user)
):
    query = db.query(GenerationRequest).filter(
        GenerationRequest.user_id == current_user.id
    )
    
    # keyword è¿‡æ»¤ä¸»è¦å­—æ®µ
    if form.keyword:
        query = query.filter(
            GenerationRequest.prompt.ilike(f'%{form.keyword}%')
        )
    
    # å…¶ä»–è¿‡æ»¤æ¡ä»¶
    if form.product_id:
        query = query.filter(GenerationRequest.product_id == form.product_id)
    
    # ä½¿ç”¨ CRUDMixin çš„åˆ†é¡µæ–¹æ³•
    return GenerationRequest.paginated_dump(
        query=query,
        form=form,
        dump_func=lambda req: {
            **req.dump(),
            'generated_images': [img.dump() for img in req.generated_images]
        }
    )
```

#### åˆ›å»º/ç¼–è¾‘ä½¿ç”¨è¡¨å•ï¼š
```python
@router.post('/web/ai/generate-images')
@user_required
async def generate_images(
    form: GenerationRequestForm,
    current_user: User = Depends(get_user)
):
    # ä½¿ç”¨ form.dict() è·å–éªŒè¯åçš„æ•°æ®
    with sm.transaction_scope() as sa:
        generation_request = GenerationRequest.create(
            sa,
            user_id=current_user.id,
            **form.dict()
        )
```

#### å…³é”®è¯è¿‡æ»¤è§„èŒƒï¼š
- **å¿…é¡»æ”¯æŒ keyword è¿‡æ»¤**ï¼šæ‰€æœ‰ Filter Form éƒ½è¦å¤„ç† keyword å­—æ®µ
- **ä½¿ç”¨ ilike æ¨¡ç³ŠåŒ¹é…**ï¼š`field.ilike(f'%{keyword}%')`
- **è¿‡æ»¤ä¸»è¦å­—æ®µ**ï¼šé€‰æ‹©æœ€é‡è¦çš„å¯æœç´¢å­—æ®µï¼ˆå¦‚åç§°ã€æè¿°ç­‰ï¼‰

#### è¡¨å•éªŒè¯åŸåˆ™ï¼š
1. **è¾“å…¥éªŒè¯**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½é€šè¿‡ Pydantic è¡¨å•éªŒè¯
2. **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ Pydantic çš„ç±»å‹æ£€æŸ¥å’Œè½¬æ¢
3. **é»˜è®¤å€¼**ï¼šä¸ºå¯é€‰å­—æ®µæä¾›åˆç†çš„é»˜è®¤å€¼
4. **å¤ç”¨æ€§**ï¼šCreate å’Œ Update å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¡¨å•
5. **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šFilter å’Œ Edit è¡¨å•èŒè´£åˆ†ç¦»

### MediaModel ä½¿ç”¨è§„èŒƒï¼ˆä¸å½“å‰å®ç°ä¸€è‡´ï¼‰

#### æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š
**MediaModel æ˜¯ç‹¬ç«‹çš„æ–‡ä»¶å­˜å‚¨è¡¨ï¼Œä¸ä¸»åŠ¨å…³è”å…¶ä»–ä¸šåŠ¡è¡¨ï¼Œå…¶ä»–è¡¨é€šè¿‡å¤–é”®å¼•ç”¨ MediaModel**

#### MediaModel è¡¨ç»“æ„ç‰¹ç‚¹ï¼š
```python
class MediaModel(CRUDMixin, ProfileMixin):
    __tablename__ = 'media'
    
    # é€šç”¨å…³è”å­—æ®µï¼Œç”¨äºå…³è”ä»»æ„ä¸šåŠ¡å¯¹è±¡
    object_type: Mapped[str] = mapped_column(Unicode, nullable=True)
    object_id: Mapped[int] = mapped_column(BigInteger, nullable=True)
    
    @declared_attr
    def object(cls):
        return generic_relationship(cls.object_type, cls.object_id)
```

#### å…³è”å…³ç³»è®¾è®¡åŸåˆ™ï¼š
1. **MediaModel ç‹¬ç«‹å­˜åœ¨**ï¼šä¸åŒ…å« user_idã€product_id ç­‰ä¸šåŠ¡ç›¸å…³å¤–é”®
2. **ä¸šåŠ¡è¡¨ä¸»åŠ¨å¼•ç”¨**ï¼šå…¶ä»–è¡¨é€šè¿‡å¤–é”®å¼•ç”¨ MediaModel.id
3. **é€šç”¨å…³è”æœºåˆ¶**ï¼šé€šè¿‡ object_type å’Œ object_id å®ç°é€šç”¨å…³è”

#### æ­£ç¡®çš„å…³è”æ–¹å¼ï¼š
```python
# âœ… æ­£ç¡®ï¼šä¸šåŠ¡è¡¨ä¸»åŠ¨å¼•ç”¨ MediaModel
class Product(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'products'
    
    user_id: Mapped[int] = mapped_column(BigInteger, ForeignKey('users.id'))
    original_image_id: Mapped[int] = mapped_column(BigInteger, ForeignKey('media.id'))
    
class User(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'users'
    
    avatar_id: Mapped[Optional[int]] = mapped_column(BigInteger, ForeignKey('media.id'), nullable=True)
```

#### æ­£ç¡®çš„æŸ¥è¯¢æ–¹å¼ï¼š
```python
# âœ… æ­£ç¡®ï¼šåªéªŒè¯ MediaModel æ˜¯å¦å­˜åœ¨
@router.post('/web/products')
@user_required
async def create_product(
    form: ProductForm,
    current_user: User = Depends(get_user)
):
    with sm.transaction_scope() as sa:
        # åªæŸ¥è¯¢ media æ˜¯å¦å­˜åœ¨ï¼Œä¸æ·»åŠ ç”¨æˆ·å…³è”æ¡ä»¶
        media = sa.query(MediaModel).filter(
            MediaModel.id == form.original_image_id
        ).first()
        
        if not media:
            raise_not_found("å›¾ç‰‡ä¸å­˜åœ¨")
        
        # åœ¨ä¸šåŠ¡å¯¹è±¡ä¸­å»ºç«‹å…³è”å…³ç³»
        product = Product.create(
            sa,
            user_id=current_user.id,
            original_image_id=form.original_image_id,
            **form.dict(exclude={'original_image_id'})
        )
        return dict(success=True, data=product.dump())
```

è¯´æ˜ï¼š`MediaModel` ä»…ç»´æŠ¤ `object_type/object_id` é€šç”¨å…³è”ä¸ `profile`ã€‚ä¸è¦ä¸ºå…¶æ·»åŠ ä¸šåŠ¡å¤–é”®ã€‚

#### æƒé™éªŒè¯çš„æ­£ç¡®æ–¹å¼ï¼š
å¦‚æœéœ€è¦éªŒè¯ç”¨æˆ·æƒé™ï¼Œåº”è¯¥é€šè¿‡ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š
```python
# âœ… æ­£ç¡®ï¼šé€šè¿‡ä¸šåŠ¡è¡¨éªŒè¯æƒé™
def verify_media_ownership(sa: Session, media_id: int, user_id: int, table_class):
    """éªŒè¯ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šçš„åª’ä½“æ–‡ä»¶ï¼ˆé€šè¿‡ä¸šåŠ¡è¡¨ï¼‰"""
    return sa.query(table_class).filter(
        table_class.original_image_id == media_id,
        table_class.user_id == user_id
    ).first() is not None
```

### æ–‡ä»¶ä¸Šä¼ è§„èŒƒ â­ é‡è¦

é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„æ–‡ä»¶ä¸Šä¼ æœºåˆ¶ï¼Œæ‰€æœ‰æ–‡ä»¶ä¸Šä¼ éƒ½é€šè¿‡ media æ¨¡å—å¤„ç†ï¼š

#### ç»Ÿä¸€ä¸Šä¼ æ¥å£ï¼š
- **æ¥å£åœ°å€**ï¼š`POST /media`
- **è®¤è¯è¦æ±‚**ï¼šä½¿ç”¨ `@login_required` è£…é¥°å™¨
- **è¿”å›æ•°æ®**ï¼šMediaModel å¯¹è±¡ï¼ŒåŒ…å« idã€filenameã€url ç­‰ä¿¡æ¯
- **æ”¯æŒæ ¼å¼**ï¼špng, jpg, jpeg, gifï¼ˆåœ¨ media/forms.py ä¸­å®šä¹‰ï¼‰

#### æ–‡ä»¶ä¸Šä¼ æµç¨‹ï¼š
1. **å‰ç«¯ä¸Šä¼ **ï¼šè°ƒç”¨ `POST /media` æ¥å£ä¸Šä¼ æ–‡ä»¶
2. **è·å– media_id**ï¼šä»å“åº”ä¸­è·å– MediaModel çš„ id
3. **ä¸šåŠ¡å…³è”**ï¼šåœ¨ä¸šåŠ¡æ¥å£ä¸­ä½¿ç”¨ media_id å…³è”åˆ°å…·ä½“ä¸šåŠ¡å¯¹è±¡

#### é”™è¯¯åšæ³•ï¼ˆç¦æ­¢ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šä¸è¦åœ¨ä¸šåŠ¡æ¨¡å—ä¸­é‡å¤å®ç°æ–‡ä»¶ä¸Šä¼ 
@router.post('/web/products/upload')
async def upload_product(file: UploadFile = File(...)):
    # é”™è¯¯ï¼šé‡å¤å®ç°æ–‡ä»¶ä¸Šä¼ é€»è¾‘
    pass
```

#### æ–‡ä»¶ä¸Šä¼ è§„èŒƒï¼š
1. **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰æ–‡ä»¶ä¸Šä¼ éƒ½ä½¿ç”¨ `/media` æ¥å£
2. **èŒè´£åˆ†ç¦»**ï¼šmedia æ¨¡å—è´Ÿè´£æ–‡ä»¶å¤„ç†ï¼Œä¸šåŠ¡æ¨¡å—è´Ÿè´£ä¸šåŠ¡é€»è¾‘
3. **ç‹¬ç«‹éªŒè¯**ï¼šåªéªŒè¯ MediaModel æ˜¯å¦å­˜åœ¨ï¼Œä¸æ·»åŠ ç”¨æˆ·å…³è”æŸ¥è¯¢
4. **ç±»å‹æ£€æŸ¥**ï¼šåœ¨ä¸šåŠ¡é€»è¾‘ä¸­å¯ä»¥é¢å¤–éªŒè¯æ–‡ä»¶ç±»å‹æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚
5. **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„æ–‡ä»¶æ ¼å¼å’Œå¤§å°é™åˆ¶åœ¨ media æ¨¡å—ä¸­å¤„ç†

### æ•°æ®æ¨¡å‹è®¾è®¡
- ç»§æ‰¿ Mixin: CRUDMixin, ProfileMixin, TrackableMixin, SoftDeleteMixin
- ä½¿ç”¨ SQLAlchemy 2.0 è¯­æ³•: `Mapped[type] = mapped_column(...)`
- JSON æ‰©å±•å­—æ®µä½¿ç”¨ ProfileMixin çš„å±æ€§è£…é¥°å™¨

### ProfileMixin ä½¿ç”¨è§„èŒƒ â­ æ ¸å¿ƒé‡è¦

ProfileMixin æä¾›äº†çµæ´»çš„ JSONB å­—æ®µæ‰©å±•æœºåˆ¶ï¼Œæ˜¯é¡¹ç›®çš„æ ¸å¿ƒè®¾è®¡æ¨¡å¼ï¼š

#### ProfileMixin å¯¹è±¡åˆ›å»ºè§„èŒƒ âš ï¸ æå…¶é‡è¦

**æ ¸å¿ƒé—®é¢˜**ï¼šåœ¨åˆ›å»ºç»§æ‰¿äº† ProfileMixin çš„å¯¹è±¡æ—¶ï¼Œ**ç»å¯¹ä¸èƒ½åœ¨ create() æ–¹æ³•ä¸­ç›´æ¥ä¼ å…¥é€šè¿‡å±æ€§è£…é¥°å™¨å®šä¹‰çš„å­—æ®µ**ï¼Œè¿™ä¼šå¯¼è‡´ `'NoneType' object does not support item assignment` é”™è¯¯ã€‚

#### æ­£ç¡®çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼š
```python
# âœ… æ­£ç¡®ï¼šåˆ†ä¸¤æ­¥åˆ›å»ºå¯¹è±¡
with sm.transaction_scope() as sa:
    # ç¬¬ä¸€æ­¥ï¼šåªä¼ å…¥ç›´æ¥çš„æ•°æ®åº“å­—æ®µ
    task = TranslationTask.create(
        sa,
        user_id=current_user.id,
        task_no=task_no,
        title=form.title,
        translation_type=form.translation_type,
        source=form.source,  # ç›´æ¥æ•°æ®åº“å­—æ®µ
        source_language=form.source_language,
        target_language=form.target_language,
        ai_model=form.ai_model,
        status=TranslationStatus.PROCESSING,
        started_at=datetime.utcnow()
    )
    
    # ç¬¬äºŒæ­¥ï¼šå•ç‹¬è®¾ç½® ProfileMixin å±æ€§
    task.source_text = form.text  # @string_property
    task.ip_address = request.client.host  # @string_property
    task.translation_config = {"url": form.url}  # @object_property
```

#### é”™è¯¯åšæ³•ï¼ˆä¸¥ç¦ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šç›´æ¥åœ¨create()ä¸­ä¼ å…¥ProfileMixinå±æ€§
task = TranslationTask.create(
    sa,
    user_id=current_user.id,
    source_text=form.text,  # é”™è¯¯ï¼è¿™æ˜¯@string_propertyï¼Œä¸æ˜¯ç›´æ¥å­—æ®µ
    ip_address=request.client.host,  # é”™è¯¯ï¼è¿™æ˜¯@string_property
    translation_config={"url": form.url}  # é”™è¯¯ï¼è¿™æ˜¯@object_property
)
```

#### åŸå› è¯´æ˜ï¼š
1. **å±æ€§è£…é¥°å™¨ä¾èµ–**ï¼š`@string_property`ã€`@object_property` ç­‰è£…é¥°å™¨éœ€è¦ `profile` å­—æ®µå·²ç»åˆå§‹åŒ–
2. **åˆå§‹åŒ–é¡ºåº**ï¼šåœ¨ `create()` è¿‡ç¨‹ä¸­ï¼Œ`profile` å­—æ®µå¯èƒ½è¿˜æ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–ä¸ºç©ºå­—å…¸
3. **èµ‹å€¼å¤±è´¥**ï¼šå½“è£…é¥°å™¨å°è¯•è®¾ç½® `instance.profile[self.name] = value` æ—¶ï¼Œå¦‚æœ `profile` ä¸º Noneï¼Œå°±ä¼šå‡ºç° NoneType é”™è¯¯

#### è¯†åˆ« ProfileMixin å±æ€§çš„æ–¹æ³•ï¼š
- æŸ¥çœ‹æ¨¡å‹å®šä¹‰ä¸­ä½¿ç”¨äº† `@string_property`ã€`@integer_property`ã€`@object_property`ã€`@array_property` ç­‰è£…é¥°å™¨çš„å­—æ®µ
- è¿™äº›å­—æ®µå­˜å‚¨åœ¨ JSONB çš„ `profile` å­—æ®µä¸­ï¼Œä¸æ˜¯ç›´æ¥çš„æ•°æ®åº“åˆ—

#### æ£€æŸ¥æ¸…å•ï¼š
- âœ… åˆ›å»ºå¯¹è±¡æ—¶åªä¼ å…¥ç›´æ¥çš„æ•°æ®åº“å­—æ®µï¼ˆæœ‰ `mapped_column` å®šä¹‰çš„å­—æ®µï¼‰
- âœ… å¯¹è±¡åˆ›å»ºåï¼Œå•ç‹¬è®¾ç½® ProfileMixin å±æ€§
- âœ… åŒºåˆ†ç›´æ¥å­—æ®µå’Œ ProfileMixin å±æ€§
- âŒ ä¸è¦åœ¨ create() ä¸­ä¼ å…¥ä»»ä½•ä½¿ç”¨å±æ€§è£…é¥°å™¨å®šä¹‰çš„å­—æ®µ
- âŒ ä¸è¦å¿½è§† `'NoneType' object does not support item assignment` é”™è¯¯

#### å­—æ®µåˆ†ç±»åŸåˆ™ï¼š
**æ ¸å¿ƒå­—æ®µï¼ˆç›´æ¥å®šä¹‰ä¸ºæ•°æ®åº“åˆ—ï¼‰**ï¼š
- éœ€è¦ç´¢å¼•æŸ¥è¯¢çš„å­—æ®µï¼ˆå¦‚ user_id, status, created_atï¼‰
- éœ€è¦å¤–é”®å…³è”çš„å­—æ®µï¼ˆå¦‚ user_id, image_idï¼‰
- éœ€è¦æ•°æ®åº“çº¦æŸçš„å­—æ®µï¼ˆå¦‚ unique, not nullï¼‰
- éœ€è¦æ’åºæˆ–è¿‡æ»¤çš„å­—æ®µ
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å­—æ®µ

**æ‰©å±•å­—æ®µï¼ˆä½¿ç”¨ ProfileMixin çš„ profile JSONB å­—æ®µï¼‰**ï¼š
- å¯é€‰çš„å…ƒæ•°æ®å­—æ®µï¼ˆå¦‚æ–‡ä»¶å¤§å°ã€åŸå§‹æ–‡ä»¶åï¼‰
- ä¸éœ€è¦ç´¢å¼•çš„æè¿°æ€§å­—æ®µï¼ˆå¦‚å¤‡æ³¨ã€æ ‡ç­¾ï¼‰
- å¯èƒ½å˜åŒ–çš„ä¸šåŠ¡å­—æ®µï¼ˆå¦‚ç”¨æˆ·åå¥½è®¾ç½®ï¼‰
- å¤æ‚æ•°æ®ç±»å‹å­—æ®µï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰
- ç¬¬ä¸‰æ–¹æœåŠ¡è¿”å›çš„é¢å¤–ä¿¡æ¯

#### å¯ç”¨çš„å±æ€§è£…é¥°å™¨ï¼š
```python
@string_property        # å­—ç¬¦ä¸²å­—æ®µ
@integer_property       # æ•´æ•°å­—æ®µ  
@float_property         # æµ®ç‚¹æ•°å­—æ®µ
@bool_property          # å¸ƒå°”å­—æ®µ
@array_property         # æ•°ç»„å­—æ®µ
@object_property        # å¯¹è±¡å­—æ®µ
@date_property          # æ—¥æœŸå­—æ®µ
@datetime_property      # æ—¥æœŸæ—¶é—´å­—æ®µ
@price_property         # ä»·æ ¼å­—æ®µï¼ˆè‡ªåŠ¨å¤„ç†åˆ†/å…ƒè½¬æ¢ï¼‰
```

#### æ ‡å‡†ä½¿ç”¨æ¨¡å¼ï¼š
```python
class Product(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'products'
    
    # æ ¸å¿ƒå­—æ®µ - ç›´æ¥å®šä¹‰ä¸ºæ•°æ®åº“åˆ—
    user_id: Mapped[int] = mapped_column(BigInteger, ForeignKey('users.id'), index=True)
    original_image_id: Mapped[int] = mapped_column(BigInteger, ForeignKey('media.id'))
    cutout_status: Mapped[str] = mapped_column(Unicode(50), default='pending', index=True)
    
    # æ‰©å±•å­—æ®µ - ä½¿ç”¨è£…é¥°å™¨å­˜å‚¨åœ¨ profile JSONB ä¸­
    @string_property
    def original_filename(self):
        """åŸå§‹æ–‡ä»¶å"""
        pass
    
    @integer_property
    def file_size(self):
        """æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰"""
        pass
    
    @array_property
    def tags(self):
        """æ ‡ç­¾åˆ—è¡¨"""
        pass
    
    @object_property
    def metadata(self):
        """å›¾ç‰‡å…ƒæ•°æ®ï¼ˆå®½é«˜ã€æ ¼å¼ç­‰ï¼‰"""
        pass
    
    def dump(self):
        return dict(
            id=self.id,
            user_id=self.user_id,
            cutout_status=self.cutout_status,
            # æ‰©å±•å­—æ®µå¯ä»¥ç›´æ¥è®¿é—®
            original_filename=self.original_filename,
            file_size=self.file_size,
            tags=self.tags,
            metadata=self.metadata,
            created_at=self.created_at.strftime(DATETIME_FORMAT),
        )
```

#### é‡è¦æ³¨æ„äº‹é¡¹ï¼š
1. **è£…é¥°å™¨å‡½æ•°ä½“å¿…é¡»æ˜¯ `pass`**ï¼Œä¸è¦å†™å…¶ä»–ä»£ç 
2. **æ‰©å±•å­—æ®µè®¿é—®å°±åƒæ™®é€šå±æ€§**ï¼Œæ— éœ€ç‰¹æ®Šè¯­æ³•
3. **ç±»å‹è½¬æ¢è‡ªåŠ¨å¤„ç†**ï¼Œè£…é¥°å™¨ä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹
4. **é»˜è®¤å€¼å¤„ç†**ï¼šå¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œè£…é¥°å™¨ä¼šè°ƒç”¨å‡½æ•°åå¯¹åº”çš„é»˜è®¤å€¼å·¥å‚
5. **ä¿®æ”¹æ‰©å±•å­—æ®µä¼šè‡ªåŠ¨æ ‡è®° profile å­—æ®µä¸ºå·²ä¿®æ”¹**ï¼Œç¡®ä¿æ•°æ®åº“æ›´æ–°

#### é”™è¯¯ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šä¸è¦åœ¨è£…é¥°å™¨å‡½æ•°ä¸­å†™é€»è¾‘
@string_property
def brand(self):
    return "default_brand"  # é”™è¯¯ï¼åº”è¯¥æ˜¯ pass

# âŒ é”™è¯¯ï¼šéœ€è¦ç´¢å¼•çš„å­—æ®µä¸åº”è¯¥æ”¾åœ¨ profile ä¸­
@string_property
def user_id(self):  # é”™è¯¯ï¼user_id éœ€è¦ç´¢å¼•ï¼Œåº”è¯¥æ˜¯ç›´æ¥å­—æ®µ
    pass
```

#### æ­£ç¡®ç¤ºä¾‹ï¼š
```python
# âœ… æ­£ç¡®ï¼šæ‰©å±•å­—æ®µä½¿ç”¨è£…é¥°å™¨
@string_property
def brand(self):
    """å“ç‰Œåç§°"""
    pass

# âœ… æ­£ç¡®ï¼šæ ¸å¿ƒå­—æ®µç›´æ¥å®šä¹‰
user_id: Mapped[int] = mapped_column(BigInteger, ForeignKey('users.id'), index=True)
```

### æ¨¡å—ç»“æ„
æ¯ä¸ªåŠŸèƒ½æ¨¡å—åŒ…å«:
- api.py: è·¯ç”±å’Œæ§åˆ¶å™¨
- models.py: æ•°æ®æ¨¡å‹
- forms.py: è¯·æ±‚éªŒè¯ (Pydantic)
- constants.py: æ¨¡å—å¸¸é‡

#### æ–‡ä»¶èŒè´£åˆ†ç¦» â­ é‡è¦
- **forms.py**: åŒ…å«è¯·æ±‚è¡¨å•éªŒè¯æ¨¡å‹ï¼Œç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥
- **api.py**: è·¯ç”±å®šä¹‰å’Œä¸šåŠ¡é€»è¾‘å®ç°ï¼Œåœ¨responsesä¸­æä¾›å“åº”ç¤ºä¾‹
- **models.py**: æ•°æ®åº“æ¨¡å‹å®šä¹‰ï¼Œä¸APIå±‚åˆ†ç¦»
- **constants.py**: æšä¸¾å¸¸é‡å’Œä¸šåŠ¡è§„åˆ™å®šä¹‰

### å¸¸é‡å®šä¹‰è§„èŒƒ â­ é‡è¦

ä½¿ç”¨ Enum å’Œ IntEnum å®šä¹‰æ¨¡å—å¸¸é‡ï¼Œæä¾›ç±»å‹å®‰å…¨å’Œæ‰©å±•å±æ€§ï¼š

#### åŸºç¡€æšä¸¾å®šä¹‰ï¼š
```python
from ..utils import Enum, IntEnum
from ..fixtures import register_enum

class CutoutStatus(IntEnum):
    PENDING = 10
    PROCESSING = 20
    COMPLETED = 30
    FAILED = 40

# è®¾ç½®æ ‡ç­¾
CutoutStatus.PENDING.label = 'ç­‰å¾…æŠ å›¾'
CutoutStatus.PROCESSING.label = 'æŠ å›¾ä¸­'
CutoutStatus.COMPLETED.label = 'æŠ å›¾å®Œæˆ'
CutoutStatus.FAILED.label = 'æŠ å›¾å¤±è´¥'

# æ³¨å†Œæšä¸¾ï¼ˆç”¨äºfixturesï¼‰
register_enum(CutoutStatus)
```

#### å¸¦æ‰©å±•å±æ€§çš„æšä¸¾ï¼š
```python
class ConversationMode(IntEnum):
    creative = 10
    balance = 20
    accuracy = 30

ConversationMode.creative.label = 'æ›´å¤šåˆ›é€ åŠ›'
ConversationMode.balance.label = 'æ›´å¤šå¹³è¡¡'
ConversationMode.accuracy.label = 'æ›´å¤šç²¾ç¡®'

# æ‰©å±•å±æ€§
ConversationMode.creative.temperature = 1
ConversationMode.balance.temperature = 0.5
ConversationMode.accuracy.temperature = 0.1

# å¦‚æœæœ‰æ‰©å±•å±æ€§ï¼Œé‡å†™dumpæ–¹æ³•
def dump(self):
    return dict(
        name=self.name,
        label=self.label,
        value=self.value,
        temperature=self.temperature,
    )
ConversationMode.dump = dump

register_enum(ConversationMode)
```

#### å¸¸é‡å®šä¹‰åŸåˆ™ï¼š
1. **ä½¿ç”¨ IntEnum**ï¼šå½“éœ€è¦æ•°æ®åº“å­˜å‚¨å’Œæ¯”è¾ƒæ—¶
2. **ä½¿ç”¨ Enum**ï¼šå½“åªéœ€è¦å­—ç¬¦ä¸²æ ‡è¯†æ—¶
3. **è®¾ç½® label**ï¼šæä¾›ç”¨æˆ·å‹å¥½çš„æ˜¾ç¤ºæ–‡æœ¬
4. **æ‰©å±•å±æ€§**ï¼šä¸ºæšä¸¾æ·»åŠ ä¸šåŠ¡ç›¸å…³çš„é…ç½®
5. **æ³¨å†Œæšä¸¾**ï¼šä½¿ç”¨ register_enum æ³¨å†Œåˆ° fixtures ç³»ç»Ÿ
6. **é‡å†™ dump**ï¼šå½“æœ‰æ‰©å±•å±æ€§æ—¶ï¼Œé‡å†™ dump æ–¹æ³•åŒ…å«æ‰€æœ‰å±æ€§

### æšä¸¾å¸¸é‡ç»Ÿä¸€è¿”å›è§„èŒƒ â­ é‡è¦

é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„ fixtures æœºåˆ¶æ¥è¿”å›æ‰€æœ‰æšä¸¾å¸¸é‡ï¼š

#### Fixtures æœºåˆ¶ï¼š
- **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰æšä¸¾å¸¸é‡é€šè¿‡ `/admin/fixtures` æ¥å£ç»Ÿä¸€è·å–
- **è‡ªåŠ¨æ³¨å†Œ**ï¼šä½¿ç”¨ `register_enum(EnumClass)` è‡ªåŠ¨æ³¨å†Œåˆ° fixtures ç³»ç»Ÿ
- **å‰ç«¯ä½¿ç”¨**ï¼šå‰ç«¯é€šè¿‡ä¸€æ¬¡è¯·æ±‚è·å–æ‰€æœ‰æšä¸¾å¸¸é‡ï¼Œæ— éœ€å•ç‹¬æ¥å£

#### æ­£ç¡®åšæ³•ï¼š
```python
# constants.py - å®šä¹‰æšä¸¾å¹¶æ³¨å†Œ
class CutoutStatus(IntEnum):
    PENDING = 10
    COMPLETED = 30

CutoutStatus.PENDING.label = 'ç­‰å¾…æŠ å›¾'
CutoutStatus.COMPLETED.label = 'æŠ å›¾å®Œæˆ'

register_enum(CutoutStatus)  # æ³¨å†Œåˆ°fixturesç³»ç»Ÿ
```

#### é”™è¯¯åšæ³•ï¼ˆç¦æ­¢ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šä¸è¦ä¸ºæšä¸¾å¸¸é‡å•ç‹¬åˆ›å»ºAPIæ¥å£
@router.get('/web/cutout-status-options')
def get_cutout_status_options():
    # âŒ é”™è¯¯ï¼šåº”è¯¥ä½¿ç”¨ç»Ÿä¸€çš„fixturesæœºåˆ¶
return [status.dump() for status in CutoutStatus]
```

#### ä½¿ç”¨åŸåˆ™ï¼š
1. **ç»Ÿä¸€è·å–**ï¼šæšä¸¾å¸¸é‡é€šè¿‡ fixtures ç»Ÿä¸€è¿”å›ï¼Œä¸è¦é‡å¤åˆ›å»ºæ¥å£
2. **è‡ªåŠ¨æ³¨å†Œ**ï¼šæ‰€æœ‰æšä¸¾éƒ½å¿…é¡»ä½¿ç”¨ `register_enum()` æ³¨å†Œ
3. **å‰ç«¯ç¼“å­˜**ï¼šå‰ç«¯å¯ä»¥ç¼“å­˜ fixtures æ•°æ®ï¼Œå‡å°‘é‡å¤è¯·æ±‚
4. **ä¿æŒä¸€è‡´**ï¼šæ‰€æœ‰æ¨¡å—çš„æšä¸¾å¸¸é‡éƒ½éµå¾ªç›¸åŒçš„è·å–æ–¹å¼

### é…ç½®ä¿¡æ¯ä¸å¸¸é‡åˆ†ç¦»è§„èŒƒ â­ é‡è¦

ä¸¥æ ¼åŒºåˆ†é…ç½®ä¿¡æ¯å’Œå¸¸é‡å®šä¹‰ï¼Œç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå®‰å…¨æ€§ï¼š

#### é…ç½®ä¿¡æ¯ï¼ˆconfig.pyï¼‰ï¼š
- **APIå¯†é’¥å’Œä»¤ç‰Œ**ï¼šå¦‚ `REMOVE_BG_API_KEY`ã€`GPT_TOKEN`
- **æœåŠ¡ç«¯ç‚¹å’ŒURL**ï¼šå¦‚ `EXTERNAL_URL`ã€`REDIS_HOST`
- **æ¨¡å‹åç§°å’Œç‰ˆæœ¬**ï¼šå¦‚ `GPT_MODAL_NAME`ã€`GPT_ADVANCED_MODAL_NAME`
- **æ•°é‡é™åˆ¶å’Œé˜ˆå€¼**ï¼šå¦‚ `GPT_MAX_OUTPUT_TOKENS`ã€`AI_GENERATE_WORD_LIMIT`
- **è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°**ï¼šå¦‚å…·ä½“çš„æ•°å€¼é…ç½®
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šå¦‚ `DEFAULT_THUMBNAIL_SIZE`
- **ç¯å¢ƒç›¸å…³é…ç½®**ï¼šå¦‚ `DEBUG`ã€`ENV`

#### å¸¸é‡å®šä¹‰ï¼ˆconstants.pyï¼‰ï¼š
- **æšä¸¾ç±»å‹**ï¼šå¦‚çŠ¶æ€æšä¸¾ã€ç±»å‹æšä¸¾
- **å›ºå®šçš„ä¸šåŠ¡è§„åˆ™**ï¼šå¦‚æ”¯æŒçš„æ–‡ä»¶æ ¼å¼åˆ—è¡¨
- **ä¸å˜çš„æ ‡è¯†ç¬¦**ï¼šå¦‚é”™è¯¯ä»£ç ã€äº‹ä»¶ç±»å‹

#### æ­£ç¡®ç¤ºä¾‹ï¼š
```python
# config.py - é…ç½®ä¿¡æ¯
class Settings(BaseSettings):
    REMOVE_BG_API_KEY: str = 'your_api_key'
    REMOVE_BG_TIMEOUT: int = 30
    REMOVE_BG_MAX_RETRIES: int = 3
    OPENAI_MODEL_NAME: str = 'dall-e-3'
    OPENAI_MAX_IMAGES: int = 4

# constants.py - æšä¸¾å¸¸é‡
class AIServiceType(IntEnum):
    REMOVE_BG = 10
    OPENAI_DALLE = 20

class AIServiceStatus(IntEnum):
    PENDING = 10
    SUCCESS = 30
    FAILED = 40

# å›ºå®šçš„ä¸šåŠ¡è§„åˆ™
SUPPORTED_IMAGE_FORMATS = ['jpg', 'jpeg', 'png', 'webp']
```

#### é”™è¯¯ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šä¸è¦åœ¨ constants.py ä¸­æ”¾é…ç½®ä¿¡æ¯
REMOVE_BG_API_KEY = 'your_api_key'  # åº”è¯¥åœ¨ config.py
OPENAI_TIMEOUT = 60  # åº”è¯¥åœ¨ config.py

# âŒ é”™è¯¯ï¼šä¸è¦åœ¨ config.py ä¸­å®šä¹‰æšä¸¾
class AIServiceType(IntEnum):  # åº”è¯¥åœ¨ constants.py
    REMOVE_BG = 10
```

#### ä½¿ç”¨åŸåˆ™ï¼š
1. **é…ç½®å¯å˜**ï¼šæ”¾åœ¨ config.pyï¼Œæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–
2. **å¸¸é‡ä¸å˜**ï¼šæ”¾åœ¨ constants.pyï¼Œä»£ç ä¸­ç›´æ¥å¼•ç”¨
3. **å®‰å…¨è€ƒè™‘**ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆAPIå¯†é’¥ï¼‰å¿…é¡»åœ¨ config.py ä¸­
4. **éƒ¨ç½²çµæ´»**ï¼šé…ç½®ä¿¡æ¯æ”¯æŒä¸åŒç¯å¢ƒçš„ä¸åŒå€¼
5. **ä»£ç æ¸…æ™°**ï¼šå¸¸é‡å®šä¹‰æä¾›ç±»å‹å®‰å…¨å’Œæ ‡ç­¾

### æšä¸¾ç±»å‹åœ¨æ•°æ®æ¨¡å‹ä¸­çš„ä½¿ç”¨è§„èŒƒï¼ˆå¯é€‰ï¼‰

å½“åœ¨æ•°æ®æ¨¡å‹ä¸­ä½¿ç”¨æšä¸¾ç±»å‹æ—¶ï¼Œéµå¾ªä»¥ä¸‹è§„èŒƒï¼š

#### æ•°æ®åº“å­—æ®µå®šä¹‰ï¼š
```python
from .constants import CutoutStatus

class Product(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'products'
    
    # ä½¿ç”¨ Mapped[EnumType] ç±»å‹æ³¨è§£ï¼Œæ•°æ®åº“å­˜å‚¨ä¸º Integer
    cutout_status: Mapped[CutoutStatus] = mapped_column(
        Integer, nullable=False, default=CutoutStatus.PENDING, 
        index=True, comment='æŠ å›¾çŠ¶æ€'
    )
```

è¯´æ˜ï¼šé¡¹ç›®ä¸­æš‚æœªå¤§é‡ä½¿ç”¨ `IntEnum` ç›´æ¥æ˜ å°„åˆ°åˆ—ï¼ˆä½†å·¥å…·å·²æä¾›ï¼‰ï¼Œå¯æŒ‰éœ€é‡‡ç”¨å¹¶åœ¨ `dump()` ä¸­è¿›è¡Œåˆå§‹åŒ–å†è¾“å‡ºã€‚

#### æšä¸¾å­—æ®µä½¿ç”¨åŸåˆ™ï¼š
1. **ç±»å‹æ³¨è§£**ï¼šä½¿ç”¨ `Mapped[EnumType]` è€Œä¸æ˜¯ `Mapped[int]`
2. **æ•°æ®åº“ç±»å‹**ï¼šmapped_column ä¸­ä½¿ç”¨ `Integer` å­˜å‚¨æšä¸¾å€¼
3. **é»˜è®¤å€¼**ï¼šç›´æ¥ä½¿ç”¨æšä¸¾æˆå‘˜ä½œä¸ºé»˜è®¤å€¼ï¼ˆå¦‚ `CutoutStatus.PENDING`ï¼‰
4. **åºåˆ—åŒ–**ï¼šåœ¨ dump æ–¹æ³•ä¸­è°ƒç”¨ `EnumType.init(self.field_name).dump()` è·å–å®Œæ•´æšä¸¾ä¿¡æ¯
5. **ç´¢å¼•**ï¼šçŠ¶æ€ç±»æšä¸¾å­—æ®µé€šå¸¸éœ€è¦æ·»åŠ ç´¢å¼•ç”¨äºæŸ¥è¯¢è¿‡æ»¤

#### å®Œæ•´ç¤ºä¾‹ï¼š
```python
# constants.py
class CutoutStatus(IntEnum):
    PENDING = 10
    PROCESSING = 20
    COMPLETED = 30
    FAILED = 40

CutoutStatus.PENDING.label = 'ç­‰å¾…æŠ å›¾'
CutoutStatus.PROCESSING.label = 'æŠ å›¾ä¸­'
CutoutStatus.COMPLETED.label = 'æŠ å›¾å®Œæˆ'
CutoutStatus.FAILED.label = 'æŠ å›¾å¤±è´¥'

register_enum(CutoutStatus)

# models.py
class Product(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'products'
    
    cutout_status: Mapped[CutoutStatus] = mapped_column(
        Integer, nullable=False, default=CutoutStatus.PENDING, 
        index=True, comment='æŠ å›¾çŠ¶æ€'
    )
    
    def dump(self):
        return dict(
            id=self.id,
            cutout_status=CutoutStatus.init(self.cutout_status).dump(),  # è¿”å› {name, label, value}
            created_at=self.created_at.strftime(DATETIME_FORMAT),
        )
```

#### æ³¨æ„äº‹é¡¹ï¼š
- âœ… ä½¿ç”¨ `Mapped[EnumType]` ç±»å‹æ³¨è§£æä¾›ç±»å‹å®‰å…¨
- âœ… æ•°æ®åº“å­—æ®µä½¿ç”¨ `Integer` ç±»å‹å­˜å‚¨æšä¸¾å€¼
- âœ… dump æ–¹æ³•ä¸­è°ƒç”¨ `EnumType.init(field).dump()` è·å–æšä¸¾çš„å®Œæ•´ä¿¡æ¯
- âŒ ä¸è¦ä½¿ç”¨ `Mapped[int]` ä¸¢å¤±ç±»å‹ä¿¡æ¯
- âŒ ä¸è¦åœ¨ dump ä¸­ç›´æ¥è¿”å›æšä¸¾å€¼ï¼Œåº”è¯¥å…ˆè°ƒç”¨ `EnumType.init()` å†è°ƒç”¨ `.dump()` æ–¹æ³•

### æ•°æ®æ¨¡å‹dumpæ–¹æ³•è§„èŒƒ â­ æå…¶é‡è¦

#### æ ¸å¿ƒåŸåˆ™ï¼š
æ‰€æœ‰æ•°æ®æ¨¡å‹çš„dumpæ–¹æ³•å¿…é¡»æ­£ç¡®å¤„ç†æšä¸¾å­—æ®µå’Œæ—¶é—´å­—æ®µï¼Œç¡®ä¿è¿”å›æ ¼å¼çš„ä¸€è‡´æ€§ã€‚

#### æšä¸¾å­—æ®µå¤„ç†è§„èŒƒï¼š
**å…³é”®é—®é¢˜**ï¼šæ•°æ®åº“å­˜å‚¨çš„æ˜¯intç±»å‹ï¼Œç›´æ¥è°ƒç”¨ `.dump()` ä¼šæŠ¥é”™ï¼Œå¿…é¡»å…ˆåˆå§‹åŒ–ä¸ºæšä¸¾å¯¹è±¡ã€‚

```python
# âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨dumpä¼šæŠ¥é”™ï¼Œå› ä¸ºæ˜¯intç±»å‹
def dump(self):
    return dict(
        status=self.status.dump(),  # é”™è¯¯ï¼self.statusæ˜¯intï¼Œæ²¡æœ‰dumpæ–¹æ³•
        degree_level=self.degree_level.dump()  # é”™è¯¯ï¼
    )

# âœ… æ­£ç¡®ï¼šå…ˆç”¨EnumType.init()åˆå§‹åŒ–ï¼Œå†è°ƒç”¨dump()
def dump(self):
    return dict(
        status=EducationStatus.init(self.status).dump(),
        degree_level=DegreeLevel.init(self.degree_level).dump(),
    )
```

#### æ—¶é—´å­—æ®µæ ¼å¼åŒ–è§„èŒƒï¼š
å½“å‰é¡¹ç›®æœªæä¾›ç»Ÿä¸€çš„æ—¶åŒº/æ ¼å¼åŒ–å·¥å…·å‡½æ•°ã€‚å¯ä»¥åœ¨å„æ¨¡å‹ä¸­æŒ‰éœ€è¿›è¡Œæ ¼å¼åŒ–ï¼›è‹¥åç»­æ–°å¢ç»Ÿä¸€å·¥å…·ï¼Œå†é€æ­¥è¿ç§»ç»Ÿä¸€å†™æ³•ã€‚

#### æ ‡å‡†dumpæ–¹æ³•æ¨¡æ¿ï¼š
```python
from .constants import StatusEnum, TypeEnum

class ExampleModel(CRUDMixin, ProfileMixin, TrackableMixin):
    __tablename__ = 'examples'
    
    status: Mapped[StatusEnum] = mapped_column(Integer, default=StatusEnum.PENDING)
    type: Mapped[TypeEnum] = mapped_column(Integer, default=TypeEnum.DEFAULT)
    
    def dump(self):
        """åºåˆ—åŒ–è¾“å‡º"""
        return dict(
            id=self.id,
            # æšä¸¾å­—æ®µï¼šå…ˆinitå†dump
            status=StatusEnum.init(self.status).dump(),
            type=TypeEnum.init(self.type).dump(),
            
            # æ—¶é—´å­—æ®µï¼šå¯æŒ‰éœ€æ ¼å¼åŒ–ï¼Œæˆ–åœ¨åç»­å¼•å…¥ç»Ÿä¸€å‡½æ•°åç»Ÿä¸€æ›¿æ¢
            # created_at=format_utc_to_shanghai_str(self.created_at),
            # updated_at=format_utc_to_shanghai_str(self.updated_at),
            
            # å…¶ä»–å­—æ®µ
            name=self.name,
            description=self.description,
        )
```

#### dumpæ–¹æ³•å¼€å‘æ£€æŸ¥æ¸…å•ï¼š
- âœ… æšä¸¾å­—æ®µä½¿ç”¨ `EnumType.init(self.field).dump()` æ ¼å¼
- ï¼ˆå»ºè®®ï¼‰å¦‚åç»­æä¾›ç»Ÿä¸€å‡½æ•°ï¼Œå†ç»Ÿä¸€æ›¿æ¢ä¸ºè¯¥å‡½æ•°
- âŒ ä¸è¦ç›´æ¥è°ƒç”¨æšä¸¾çš„dumpæ–¹æ³•ï¼š`self.status.dump()`
- âŒ ä¸è¦ä½¿ç”¨ strftime(DATETIME_FORMAT)ï¼š`self.created_at.strftime(DATETIME_FORMAT)`
- âŒ ä¸è¦ä½¿ç”¨isoformat()ï¼š`self.created_at.isoformat()`
- âŒ ä¸è¦æ‰‹åŠ¨æ·»åŠ  None æ£€æŸ¥ï¼š`self.updated_at.strftime(...) if self.updated_at else None`

#### å¸¸è§é”™è¯¯ä¿®å¤å¯¹ç…§è¡¨ï¼š
```python
# é”™è¯¯ â†’ æ­£ç¡®
self.status.dump() â†’ StatusEnum.init(self.status).dump()
self.created_at.strftime(DATETIME_FORMAT) â†’ format_utc_to_shanghai_str(self.created_at)
self.created_at.isoformat() â†’ format_utc_to_shanghai_str(self.created_at)
self.updated_at.strftime(DATETIME_FORMAT) if self.updated_at else None â†’ format_utc_to_shanghai_str(self.updated_at)
```

## å‰ç«¯å¼€å‘è§„èŒƒ (vige-web, vige-bo, vige-wechat)

### æŠ€æœ¯æ ˆé€‰æ‹©
- vige-bo (åå°): Vue 2 + iView (åŠŸèƒ½ä¸°å¯Œçš„ç®¡ç†ç•Œé¢)
- vige-web (å‰ç«¯): Vue 2 + iView (ä¿æŒä¸€è‡´æ€§)
- vige-wechat (å¾®ä¿¡): Vue 2 + Mint UI (ç§»åŠ¨ç«¯ä¼˜åŒ–)

### å…±åŒæŠ€æœ¯æ ˆ
- Vue Router (è·¯ç”±ç®¡ç†)
- Vuex (çŠ¶æ€ç®¡ç†)
- vue-auth (è®¤è¯ç®¡ç†)
- axios (HTTP å®¢æˆ·ç«¯)
- vue-i18n (å›½é™…åŒ–)
- Less (CSS é¢„å¤„ç†å™¨)

### API å“åº”å¤„ç†è§„èŒƒ âš ï¸ æå…¶é‡è¦

#### axios å“åº”æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†
é¡¹ç›®ä¸­çš„ `api.js` å·²é…ç½®å“åº”æ‹¦æˆªå™¨ï¼Œ**è‡ªåŠ¨æå– data å­—æ®µ**ï¼š

```javascript
api.interceptors.response.use(response => {
  if (!response.config.hideProgress) {
    iView.LoadingBar.finish()
  }
  return response.data  // è‡ªåŠ¨è¿”å› response.data
}, (error) => {
```

#### æ­£ç¡®çš„APIå“åº”å¤„ç†æ–¹å¼ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨ responseï¼Œä¸éœ€è¦ .data
const response = await this.$http.post('/web/ai/cutout-image', data)

if (response && response.success) {
  // ç›´æ¥è®¿é—® response.dataï¼Œä¸æ˜¯ response.data.data
  this.result = response.data
  this.$Message.success(response.message)
} else {
  this.$Message.error(response.message || 'æ“ä½œå¤±è´¥')
}
```

#### é”™è¯¯çš„å¤„ç†æ–¹å¼ï¼ˆç¦æ­¢ï¼‰ï¼š
```javascript
// âŒ é”™è¯¯ï¼šé‡å¤æå– data å­—æ®µ
const response = await this.$http.post('/web/api', data)

if (response.data && response.data.success) {  // é”™è¯¯ï¼
  this.result = response.data.data  // é”™è¯¯ï¼
}
```

#### APIå“åº”ç»“æ„è¯´æ˜ï¼š
- **åç«¯APIè¿”å›**ï¼š`{success: true, data: {...}, message: "..."}`
- **axiosæ‹¦æˆªå™¨å¤„ç†å**ï¼šç›´æ¥è¿”å›ä¸Šè¿°ç»“æ„ï¼Œæ— éœ€å†æ¬¡è®¿é—® `.data`
- **å‰ç«¯ä½¿ç”¨**ï¼š`response.success`ã€`response.data`ã€`response.message`

### æ¥å£è°ƒç”¨è§„èŒƒ âš ï¸ é‡è¦

#### æ ¸å¿ƒåŸåˆ™ï¼š
1. **API URL è§„èŒƒ**: api.js ä¸­å·²è®¾ç½® baseURL ä¸º '/v1'ï¼Œå‰ç«¯è°ƒç”¨æ—¶ä¸è¦é‡å¤æ·»åŠ  '/v1' å‰ç¼€
2. **æ¥å£ç¡®è®¤**: å¦‚æœä¸ç¡®å®šåº”è¯¥è°ƒç”¨å“ªä¸ªæ¥å£ï¼Œå¿…é¡»å…ˆè¯¢é—®ç¡®è®¤ï¼Œä¸è¦çŒœæµ‹æˆ–è°ƒç”¨é”™è¯¯çš„æ¥å£
3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰æ¥å£è°ƒç”¨éƒ½è¦æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†

#### æ­£ç¡®çš„æ¥å£è°ƒç”¨æ–¹å¼ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šWebç«¯æ¥å£ä½¿ç”¨ /web/ å‰ç¼€
const response = await this.$http.post('/web/translations', data)
const response = await this.$http.get('/web/users/123')

// âœ… æ­£ç¡®ï¼šåå°ç®¡ç†æ¥å£ä½¿ç”¨ /admin/ å‰ç¼€  
const response = await this.$http.post('/admin/users', data)
const response = await this.$http.get('/admin/settings')

// âŒ é”™è¯¯ï¼šä½¿ç”¨äº†é”™è¯¯çš„å‰ç¼€
const response = await this.$http.post('/api/users', data)  // åº”è¯¥æ˜¯ /web/ æˆ– /admin/
const response = await this.$http.post('/v1/web/users', data)  // é‡å¤çš„ /v1 å‰ç¼€
```

#### æ¥å£è°ƒç”¨æµç¨‹ï¼š
1. **ç¡®è®¤æ¥å£**: å…ˆç¡®è®¤è¦è°ƒç”¨çš„æ­£ç¡®æ¥å£è·¯å¾„å’Œå‚æ•°
2. **ä½¿ç”¨æ­£ç¡®URL**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸åŒ…å« /v1 å‰ç¼€
3. **é”™è¯¯å¤„ç†**: æ·»åŠ  try-catch å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
4. **è°ƒè¯•ä¿¡æ¯**: åœ¨å¼€å‘æ¨¡å¼ä¸‹æ·»åŠ  console.log ç”¨äºè°ƒè¯•

#### é”™è¯¯åšæ³•ï¼ˆç¦æ­¢ï¼‰ï¼š
```javascript
// âŒ é”™è¯¯ï¼šè°ƒç”¨ä¸å­˜åœ¨çš„æ¥å£
async fetchData() {
  const response = await this.$http.get('/web/some/nonexistent/api')
}

// âŒ é”™è¯¯ï¼šæ²¡æœ‰é”™è¯¯å¤„ç†
async fetchData() {
  const response = await this.$http.get('/web/users/me')
  this.data = response.data // å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
}

// âŒ é”™è¯¯ï¼šé‡å¤çš„ /v1 å‰ç¼€
async fetchData() {
  const response = await this.$http.get('/v1/web/users/me') // ä¼šå˜æˆ /v1/v1/web/users/me
}
```

### ESè¯­æ³•å…¼å®¹æ€§è§„èŒƒ âš ï¸ æå…¶é‡è¦

#### ç¦ç”¨çš„ES2020+è¯­æ³•ï¼š
é¡¹ç›®ä½¿ç”¨è¾ƒæ—§çš„Babelé…ç½®ï¼Œ**ä¸¥ç¦ä½¿ç”¨**ä»¥ä¸‹ES2020+è¯­æ³•ï¼š

1. **å¯é€‰é“¾æ“ä½œç¬¦ `?.`**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
const value = obj?.property?.subProperty
const result = func?.()
const item = arr?.[0]

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¼ ç»Ÿçš„å®‰å…¨æ£€æŸ¥
const value = obj && obj.property && obj.property.subProperty
const result = func && func()
const item = arr && arr[0]
```

2. **ç©ºå€¼åˆå¹¶æ“ä½œç¬¦ `??`**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
const value = input ?? defaultValue

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¼ ç»Ÿçš„é»˜è®¤å€¼æ£€æŸ¥
const value = input !== null && input !== undefined ? input : defaultValue
// æˆ–è€…å¯¹äºfalsyå€¼ï¼š
const value = input || defaultValue
```

3. **åŠ¨æ€å¯¼å…¥ `import()`**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šå¯èƒ½ä¸è¢«æ”¯æŒ
const module = await import('./module.js')

// âœ… æ­£ç¡®ï¼šä½¿ç”¨é™æ€å¯¼å…¥æˆ–require
import module from './module.js'
// æˆ–è€…åœ¨éœ€è¦æ—¶ä½¿ç”¨webpackçš„require.ensure
```

#### å®‰å…¨çš„æ•°æ®è®¿é—®æ¨¡å¼ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„é“¾å¼æ£€æŸ¥
if (response && response.data && response.data.user) {
  this.user = response.data.user
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦
const userName = user && user.profile && user.profile.name || 'æœªçŸ¥ç”¨æˆ·'

// âœ… æ­£ç¡®ï¼šä¸‰å…ƒè¿ç®—ç¬¦
const isValid = data && data.status ? data.status === 'active' : false

// âœ… æ­£ç¡®ï¼šæå‰è¿”å›æ¨¡å¼
if (!response || !response.data) {
  return
}
// å®‰å…¨ä½¿ç”¨ response.data
```

#### ç¼–è¯‘é”™è¯¯é¢„é˜²åŸåˆ™ï¼š
1. **é¿å…ç°ä»£è¯­æ³•**ï¼šä¸ä½¿ç”¨ES2020+çš„æ–°è¯­æ³•ç‰¹æ€§
2. **ä¼ ç»Ÿæ£€æŸ¥**ï¼šä½¿ç”¨ `&&` è¿ç®—ç¬¦è¿›è¡Œå®‰å…¨çš„å±æ€§è®¿é—®
3. **å…¼å®¹æ€§ä¼˜å…ˆ**ï¼šä¼˜å…ˆè€ƒè™‘ä»£ç çš„å…¼å®¹æ€§è€Œä¸æ˜¯ç®€æ´æ€§
4. **æµ‹è¯•ç¼–è¯‘**ï¼šä¿®æ”¹ä»£ç ååŠæ—¶æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯
5. **æ¸è¿›å¢å¼º**ï¼šå¦‚æœéœ€è¦ç°ä»£è¯­æ³•ï¼Œç¡®ä¿å…ˆå‡çº§Babelé…ç½®

#### å¸¸è§é”™è¯¯ä¿®å¤å¯¹ç…§è¡¨ï¼š
```javascript
// é”™è¯¯ â†’ æ­£ç¡®
obj?.prop â†’ obj && obj.prop
obj?.method?.() â†’ obj && obj.method && obj.method()
arr?.[index] â†’ arr && arr[index]
value ?? default â†’ value !== null && value !== undefined ? value : default
response?.data?.success â†’ response && response.data && response.data.success
this.uploadedFile?.original_filename â†’ this.uploadedFile && this.uploadedFile.original_filename
```

#### å®é™…é”™è¯¯æ¡ˆä¾‹ï¼š
**é”™è¯¯ä»£ç **ï¼š
```javascript
// âŒ å¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼šUnexpected token (491:47)
const originalName = this.uploadedFile?.original_filename || 'image';
```

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Module parse failed: Unexpected token (491:47)
You may need an additional loader to handle the result of these loaders.
```

**æ­£ç¡®ä¿®å¤**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¼ ç»Ÿå®‰å…¨æ£€æŸ¥
const originalName = this.uploadedFile && this.uploadedFile.original_filename || 'image';
```

### å›¾ç‰‡ä¸Šä¼ é€»è¾‘è§„èŒƒ â­ é‡è¦

#### æ ¸å¿ƒæ¦‚å¿µï¼š
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ä¼šåˆ›å»ºå›¾ç‰‡å¯¹è±¡ï¼ˆMediaModelï¼‰ï¼Œå¹¶è¿”å› media IDï¼Œè¿™ä¸ª ID æ‰æ˜¯æˆ‘ä»¬éœ€è¦å†™å…¥æŒ‡å®šè¡¨çš„ä¿¡æ¯ï¼Œä»¥ç»‘å®šå›¾ç‰‡å®ä¾‹ã€‚

#### æ ‡å‡†æµç¨‹ï¼š
1. **ä¸Šä¼ å›¾ç‰‡**ï¼šè°ƒç”¨ `POST /media` æ¥å£ä¸Šä¼ æ–‡ä»¶
2. **è·å– media_id**ï¼šä»å“åº”ä¸­è·å– MediaModel çš„ id
3. **ç»‘å®šä¸šåŠ¡å¯¹è±¡**ï¼šä½¿ç”¨ media_id åˆ›å»ºæˆ–æ›´æ–°ä¸šåŠ¡è®°å½•

#### æ­£ç¡®å®ç°ï¼š
```javascript
// æ­¥éª¤1ï¼šä¸Šä¼ å›¾ç‰‡åˆ° media æ¥å£
async handleUploadSuccess(response) {
  if (response.success) {
    const mediaId = response.data.id // è¿™æ˜¯ media ID
    
    // æ­¥éª¤2ï¼šä½¿ç”¨ media ID åˆ›å»ºä¸šåŠ¡å¯¹è±¡
    await this.createProduct(mediaId)
  }
}

// æ­¥éª¤3ï¼šåˆ›å»ºäº§å“è®°å½•ï¼Œä¼ å…¥ media ID
async createProduct(mediaId) {
  // TODO: è°ƒç”¨äº§å“åˆ›å»ºæ¥å£
  // POST /web/products { original_image_id: mediaId }
  
  const response = await this.$http.post('/web/products', {
    original_image_id: mediaId,
    product_name: this.productName
  })
}
```

#### é”™è¯¯ç†è§£ï¼ˆç¦æ­¢ï¼‰ï¼š
```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨å›¾ç‰‡URLè€Œä¸æ˜¯media ID
async createProduct() {
  const response = await this.$http.post('/web/products', {
    image_url: this.imageUrl // é”™è¯¯ï¼šåº”è¯¥ä½¿ç”¨ media_id
  })
}

// âŒ é”™è¯¯ï¼šè·³è¿‡ media ä¸Šä¼ ï¼Œç›´æ¥ä¸Šä¼ åˆ°ä¸šåŠ¡æ¥å£
async uploadProductImage(file) {
  // é”™è¯¯ï¼šåº”è¯¥å…ˆä¸Šä¼ åˆ° /media è·å– ID
  const response = await this.$http.post('/web/products/upload', {
    file: file
  })
}
```

### Vue ç»„ä»¶ç»“æ„
```javascript
export default {
  name: 'ComponentName',
  props: {},
  data() {
    return {}
  },
  computed: {},
  methods: {}
}
```

### API è°ƒç”¨é£æ ¼
- ä½¿ç”¨ `this.$http` (axios)
- å¤„ç†å“åº”çš„ success å­—æ®µ
- ç»Ÿä¸€é”™è¯¯å¤„ç†

### æƒé™æ§åˆ¶
- ä½¿ç”¨ Mixin æ–¹å¼: `this.hasPermission('permission.name')`
- è·¯ç”±æ‡’åŠ è½½: `component: () => import('@/views/...')`

### ç”¨æˆ·è®¤è¯
- ä½¿ç”¨ vue-auth è·å–ç”¨æˆ·ä¿¡æ¯ï¼š`this.$auth.user()`
- æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼š`this.$auth.check()`
- é¿å…ä¸å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯æ¥å£è°ƒç”¨

## ä»£ç ç¤ºä¾‹æ¨¡æ¿

### åç«¯ API ç¤ºä¾‹

#### æŸ¥è¯¢æ“ä½œ
```python
from fastapi import Path, Query
from ..forms import STANDARD_ERROR_RESPONSES
from ..utils import raise_user_not_found

@app.get('/web/users/{user_id}')
@user_required
async def get_user(
    user_id: int = Path(..., description="ç”¨æˆ·ID", example=1, gt=0),
    db: Session = Depends(sm.get_db),
    current_user: User = Depends(get_user)
):
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise_user_not_found()
    return dict(success=True, data=user.dump())
```

#### æ•°æ®å˜æ›´æ“ä½œ
```python
from ..utils import raise_duplicate_username, raise_role_not_found

class CreateUserForm(BaseModel):
    """åˆ›å»ºç”¨æˆ·è¡¨å•"""
    username: str = Field(
        min_length=3,
        max_length=50,
        pattern="^[a-zA-Z0-9_]+$"
    )
    password: str = Field(
        min_length=8
    )
    nickname: str = Field(
        max_length=100
    )

@app.post('/web/users')
@user_required
async def create_user(
    form: CreateUserForm,
    current_user: User = Depends(get_user)
):
    # æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤
    if User.exists(db, User.username == form.username):
        raise_duplicate_username()
    
    with sm.transaction_scope() as sa:
        user = User.create(sa, **form.dict())
        user.created_by = current_user.id
    
    return dict(success=True, data=user.dump())
```

### å‰ç«¯ Vue ç»„ä»¶ç¤ºä¾‹
```vue
<template>
  <div class="component-name">
    <i-table :data="tableData" :columns="columns"></i-table>
  </div>
</template>

<script>
export default {
  name: 'ComponentName',
  data() {
    return {
      tableData: [],
      columns: []
    }
  },
  mounted() {
    this.loadData()
  },
  methods: {
    async loadData() {
      try {
        const response = await this.$http.get('/web/users')
        if (response.success) {
          this.tableData = response.data
        }
      } catch (error) {
        this.$Message.error('åŠ è½½æ•°æ®å¤±è´¥')
      }
    }
  }
}
</script>

<style lang="less" scoped>
.component-name {
  padding: 20px;
}
</style>
```

## å¼€å‘æ³¨æ„äº‹é¡¹

### åç«¯å¼€å‘
- **æ‰§è¡Œç¯å¢ƒè¦æ±‚** âš ï¸ æå…¶é‡è¦ï¼š
  - æ‰€æœ‰åç«¯APIç›¸å…³å‘½ä»¤å¿…é¡»åœ¨ `vige-api` ç›®å½•ä¸‹æ‰§è¡Œ
  - æ‰§è¡Œå‰å¿…é¡»å…ˆå¯åŠ¨è™šæ‹Ÿç¯å¢ƒï¼š`pipenv shell`
  - å®Œæ•´æ‰§è¡Œæµç¨‹ï¼š`cd vige-api && pipenv shell && [å‘½ä»¤]`
  - ç¦æ­¢åœ¨é¡¹ç›®æ ¹ç›®å½•ç›´æ¥æ‰§è¡Œåç«¯ç›¸å…³å‘½ä»¤
- æ–°æ¨¡å—åˆ›å»ºååœ¨ `api/__init__.py` ä¸­æ³¨å†Œè·¯ç”±
- æ•°æ®æ¨¡å‹åœ¨ `db.py` ä¸­å¯¼å…¥ä»¥ä¾¿ Alembic ç”Ÿæˆè¿ç§»
- äº‹åŠ¡æ“ä½œè‡ªåŠ¨å¤„ç†æäº¤å’Œå›æ»šï¼Œæ— éœ€æ‰‹åŠ¨ commit
- æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£ä½¿ç”¨ `Depends(get_user)` éªŒè¯ JWT
- **ä¸¥æ ¼æŒ‰ç…§æ¥å£ç±»å‹ä½¿ç”¨æ­£ç¡®çš„URLå‰ç¼€**ï¼šWebç«¯ç”¨`/web/`ï¼Œåå°ç®¡ç†ç”¨`/admin/`ï¼Œå¾®ä¿¡ç«¯ç”¨`/wechat/`
- **å¿…é¡»ä½¿ç”¨å¯¹åº”çš„æƒé™éªŒè¯è£…é¥°å™¨**ï¼šWebç«¯ç”¨`@user_required`ï¼Œåå°ç®¡ç†ç”¨`@bo_required`ï¼Œå¾®ä¿¡ç«¯ç”¨`@wechat_required`

### å‰ç«¯å¼€å‘
- æ ¹æ®æ¨¡å—é€‰æ‹©æ­£ç¡®çš„ UI æ¡†æ¶ (iView vs Mint UI)
- API è°ƒç”¨å¤„ç†é”™è¯¯æƒ…å†µ
- æƒé™æ£€æŸ¥ä½¿ç”¨ `hasPermission` æ–¹æ³•
- æ ·å¼ä½¿ç”¨ Less é¢„å¤„ç†å™¨ï¼Œæ·»åŠ  scoped å±æ€§
- **ä¸è¦è°ƒç”¨ä¸å­˜åœ¨çš„æ¥å£ï¼Œä½¿ç”¨ TODO æ ‡è®°éœ€è¦å®ç°çš„åŠŸèƒ½**
- **å›¾ç‰‡ä¸Šä¼ å¿…é¡»å…ˆè·å– media_idï¼Œå†ç»‘å®šåˆ°ä¸šåŠ¡å¯¹è±¡**

### è·¨ç«¯ä¸€è‡´æ€§
- API æ¥å£ä½¿ç”¨ç«¯å‰ç¼€åŒºåˆ†
- ç»Ÿä¸€çš„å“åº”æ ¼å¼å’Œé”™è¯¯å¤„ç†
- JWT + CSRF åŒé‡è®¤è¯ä¿æŠ¤
- å›½é™…åŒ–æ”¯æŒ (åç«¯ Flask-Babel, å‰ç«¯ vue-i18n)

## ç¦æ­¢äº‹é¡¹
- âŒ **ä¸è¦åœ¨æ–°sessionä¸­æ“ä½œå…¶ä»–sessionçš„å¯¹è±¡** âš ï¸ æå…¶é‡è¦ï¼šç»å¯¹ç¦æ­¢åœ¨ `transaction_scope()` ä¸­ç›´æ¥ä¿®æ”¹ `current_user` ç­‰ä¾èµ–æ³¨å…¥å¯¹è±¡ï¼Œå¿…é¡»åœ¨æ–°sessionä¸­é‡æ–°è·å–å¯¹è±¡
- âŒ **ä¸è¦æ··ç”¨ä¸åŒsessionçš„æ•°æ®åº“å¯¹è±¡**ï¼šæ¯ä¸ªå¯¹è±¡åªèƒ½åœ¨å…¶æ‰€å±sessionä¸­è¢«æ“ä½œï¼Œè·¨sessionæ“ä½œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- âŒ **ä¸è¦åœ¨ create() æ–¹æ³•ä¸­ç›´æ¥ä¼ å…¥ ProfileMixin å±æ€§** âš ï¸ æå…¶é‡è¦ï¼šç»å¯¹ç¦æ­¢åœ¨åˆ›å»ºå¯¹è±¡æ—¶ç›´æ¥ä¼ å…¥ `@string_property`ã€`@object_property` ç­‰è£…é¥°å™¨å®šä¹‰çš„å­—æ®µï¼Œä¼šå¯¼è‡´ `'NoneType' object does not support item assignment` é”™è¯¯ï¼Œå¿…é¡»å…ˆåˆ›å»ºå¯¹è±¡å†å•ç‹¬è®¾ç½®è¿™äº›å±æ€§
- âŒ ä¸è¦æ··ç”¨æ•°æ®åº“ä¸Šä¸‹æ–‡ (Depends å’Œ transaction_scope)
- âŒ ä¸è¦åœ¨äº‹åŠ¡å†…æ‰‹åŠ¨è°ƒç”¨ commit()
- âŒ ä¸è¦å¿½ç•¥ç”¨æˆ·è®¤è¯ (ç¼ºå°‘ Depends(get_user))
- âŒ ä¸è¦åœ¨å‰ç«¯ç›´æ¥ä½¿ç”¨é”™è¯¯çš„ UI æ¡†æ¶
- âŒ ä¸è¦è°ƒç”¨ä¸å­˜åœ¨çš„æ¥å£ï¼Œä½¿ç”¨ TODO æ ‡è®°
- âŒ ä¸è¦è·³è¿‡ media ä¸Šä¼ æµç¨‹ï¼Œç›´æ¥ä½¿ç”¨å›¾ç‰‡URL
- âŒ **ä¸è¦åœ¨ MediaModel æŸ¥è¯¢ä¸­æ·»åŠ ç”¨æˆ·å…³è”æ¡ä»¶**ï¼šä¸¥ç¦ä½¿ç”¨ `MediaModel.user_id` ç­‰ä¸å­˜åœ¨çš„å­—æ®µ
- âŒ **ä¸è¦åœ¨ MediaModel ä¸­æ·»åŠ ä¸šåŠ¡å¤–é”®**ï¼šMediaModel å¿…é¡»ä¿æŒç‹¬ç«‹ï¼Œä¸åŒ…å« user_idã€product_id ç­‰ä¸šåŠ¡å­—æ®µ
- âŒ **ä¸è¦é”™è¯¯ç†è§£ MediaModel å…³è”å…³ç³»**ï¼šæ˜¯å…¶ä»–è¡¨å¼•ç”¨ MediaModelï¼Œä¸æ˜¯ MediaModel å¼•ç”¨å…¶ä»–è¡¨
- âŒ ä¸è¦åœ¨æ¥å£å‚æ•°ä¸­ç½—åˆ—å¤§é‡å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨è¡¨å•æ–¹å¼é›†ä¸­ç®¡ç†
- âŒ ä¸è¦åœ¨GETæ¥å£ä¸­ä½¿ç”¨è¿‡å¤šå•ç‹¬çš„Queryå‚æ•°ï¼Œä¼˜å…ˆä½¿ç”¨Dependsè¡¨å•
- âŒ ä¸è¦ç›´æ¥æŠ›å‡º HTTPExceptionï¼Œå¿…é¡»ä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å‡½æ•°
- âŒ ä¸è¦ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯å“åº”æ ¼å¼ï¼Œå¿…é¡»éµå¾ªç»Ÿä¸€æ ‡å‡†
- âŒ ä¸è¦æ··ç”¨HTTPçŠ¶æ€ç ï¼Œç¡®ä¿çŠ¶æ€ç ä¸é”™è¯¯ç±»å‹åŒ¹é…
- âŒ ä¸è¦ä½¿ç”¨é”™è¯¯çš„APIå‰ç¼€ï¼ˆWebç«¯å¿…é¡»ç”¨/web/ï¼Œåå°ç®¡ç†å¿…é¡»ç”¨/admin/ï¼Œå¾®ä¿¡ç«¯å¿…é¡»ç”¨/wechat/ï¼‰
- âŒ ä¸è¦ä½¿ç”¨é”™è¯¯çš„æƒé™éªŒè¯è£…é¥°å™¨ï¼ˆ/web/ç”¨@user_requiredï¼Œ/admin/ç”¨@bo_requiredï¼Œ/wechat/ç”¨@wechat_requiredï¼‰
- âŒ ä¸è¦æ··ç”¨æƒé™éªŒè¯è£…é¥°å™¨ï¼Œå¿…é¡»ä¸æ¥å£å‰ç¼€ä¸¥æ ¼å¯¹åº”
- âŒ **ä¸è¦ä½¿ç”¨ Pydantic 1.x è¯­æ³•**ï¼šä¸¥ç¦ä½¿ç”¨ `regex` å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨ `pattern`
- âŒ **ä¸è¦ä½¿ç”¨è¿‡æ—¶çš„é…ç½®è¯­æ³•**ï¼šä¸¥ç¦ä½¿ç”¨ `schema_extra`ï¼Œå¿…é¡»ä½¿ç”¨ `json_schema_extra`
- âŒ **ä¸è¦å¿½ç•¥ Pydantic é”™è¯¯æç¤º**ï¼šé‡åˆ° PydanticUserError å¿…é¡»ç«‹å³æŒ‰è§„èŒƒä¿®å¤

## æ¨èåšæ³•
- âœ… ä½¿ç”¨ Mixin æä¾›é€šç”¨åŠŸèƒ½
- âœ… äº‹åŠ¡æ“ä½œä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- âœ… **ProfileMixin å¯¹è±¡åˆ›å»ºä½¿ç”¨ä¸¤æ­¥æ³•**ï¼šå…ˆåˆ›å»ºå¯¹è±¡ï¼ˆåªä¼ å…¥ç›´æ¥æ•°æ®åº“å­—æ®µï¼‰ï¼Œå†å•ç‹¬è®¾ç½® ProfileMixin å±æ€§ï¼ˆ`@string_property`ã€`@object_property` ç­‰è£…é¥°å™¨å­—æ®µï¼‰
- âœ… API å“åº”æ ¼å¼ä¿æŒä¸€è‡´
- âœ… å‰ç«¯ç»„ä»¶èŒè´£å•ä¸€ï¼Œç»“æ„æ¸…æ™°
- âœ… æ·»åŠ å¿…è¦çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… ä½¿ç”¨ TODO æ ‡è®°éœ€è¦å®ç°çš„åŠŸèƒ½
- âœ… å›¾ç‰‡ä¸Šä¼ å…ˆè·å– media_idï¼Œå†ç»‘å®šä¸šåŠ¡å¯¹è±¡
- âœ… ä½¿ç”¨è¡¨å•æ–¹å¼é›†ä¸­ç®¡ç†æ¥å£å‚æ•°ï¼Œé¿å…å‚æ•°åˆ—è¡¨è¿‡é•¿
- âœ… GETæ¥å£ä¼˜å…ˆä½¿ç”¨ Depends(Form) è€Œä¸æ˜¯å¤šä¸ª Query å‚æ•°
- âœ… åˆ©ç”¨ Pydantic è¡¨å•æä¾›å®Œæ•´çš„å‚æ•°éªŒè¯å’Œ API æ–‡æ¡£
- âœ… ä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å¤„ç†å‡½æ•° (raise_user_not_found, raise_invalid_credentials ç­‰)
- âœ… åœ¨APIè·¯ç”±ä¸­åŒ…å« STANDARD_ERROR_RESPONSES é…ç½®
- âœ… é”™è¯¯ä¿¡æ¯ä½¿ç”¨ç”¨æˆ·å‹å¥½çš„ä¸­æ–‡æè¿°
- âœ… ä¸ºæ¯ç§é”™è¯¯ç±»å‹æä¾›æ˜ç¡®çš„é”™è¯¯ä»£ç 
- âœ… ä¸¥æ ¼æŒ‰ç…§æ¥å£ç±»å‹ä½¿ç”¨æ­£ç¡®çš„URLå‰ç¼€ï¼ˆ/web/ã€/admin/ æˆ– /wechat/ï¼‰
- âœ… æ ¹æ®æ¥å£å‰ç¼€ä½¿ç”¨æ­£ç¡®çš„æƒé™éªŒè¯è£…é¥°å™¨ï¼ˆ/web/â†’@user_requiredï¼Œ/admin/â†’@bo_requiredï¼Œ/wechat/â†’@wechat_requiredï¼‰
- âœ… ç¡®ä¿æƒé™éªŒè¯è£…é¥°å™¨ä¸æ¥å£ç±»å‹ä¸¥æ ¼å¯¹åº”ï¼Œä¿è¯è¯·æ±‚æ¥æºå®‰å…¨
- âœ… **ä½¿ç”¨ Pydantic 2.x æ ‡å‡†è¯­æ³•**ï¼šæ‰€æœ‰è¡¨å•å­—æ®µéªŒè¯ä½¿ç”¨ `pattern` è€Œä¸æ˜¯ `regex`
- âœ… **ä½¿ç”¨ç°ä»£é…ç½®è¯­æ³•**ï¼šé…ç½®ç±»ä¸­ä½¿ç”¨ `json_schema_extra` è€Œä¸æ˜¯ `schema_extra`
- âœ… **å®šæœŸæ£€æŸ¥å…¼å®¹æ€§**ï¼šåˆ›å»ºè¡¨å•ç±»æ—¶å‚è€ƒæ ‡å‡†æ¨¡æ¿ï¼Œç¡®ä¿è¯­æ³•æ­£ç¡®

## æ–‡ä»¶å‘½åè§„èŒƒ
- åç«¯: snake_case (user_api.py, user_models.py)
- å‰ç«¯: kebab-case æˆ– PascalCase (UserList.vue, user-detail.vue)
- é…ç½®æ–‡ä»¶: å°å†™ (config.py, .env)

## æ³¨é‡Šè§„èŒƒ
- ä¸­æ–‡æ³¨é‡Šï¼Œç®€æ´æ˜äº†
- å¤æ‚ä¸šåŠ¡é€»è¾‘å¿…é¡»æ·»åŠ æ³¨é‡Š
- API æ¥å£æ·»åŠ åŠŸèƒ½è¯´æ˜
- æ•°æ®æ¨¡å‹å­—æ®µæ·»åŠ æ³¨é‡Š
- ä½¿ç”¨ TODO æ ‡è®°éœ€è¦å®ç°çš„åŠŸèƒ½

ï¼ˆè¯´æ˜ï¼‰æœ¬è§„èŒƒé¢å‘ Vige é€šç”¨é¡¹ç›®æ¨¡æ¿ï¼Œç¤ºä¾‹æ¶‰åŠçš„å…·ä½“ä¸šåŠ¡ä»…ä½œå‚è€ƒï¼Œå¯æ ¹æ®å®é™…ä¸šåŠ¡è£å‰ªã€‚

## æ–‡æ¡£ç¼–å†™è§„èŒƒ â­ é‡è¦
- **é»˜è®¤ä¸å†™æ–‡æ¡£**ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ›´æ–°åŠŸèƒ½å’Œä»£ç æ—¶ï¼Œä¸éœ€è¦å†™æ–‡æ¡£
- **æ˜ç¡®è¦æ±‚æ‰å†™**ï¼šé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚å†™æ–‡æ¡£ï¼Œå¦åˆ™ä¸“æ³¨äºä»£ç å®ç°
- **ç®€æ´å®ç”¨**ï¼šå¦‚æœéœ€è¦å†™æ–‡æ¡£ï¼Œä¿æŒç®€æ´å®ç”¨ï¼Œé‡ç‚¹çªå‡ºå…³é”®ä¿¡æ¯
- **æ’ä»¶å¼€å‘ç¦æ­¢æ–‡æ¡£**ï¼šmini_translate-extension ç›®å½•ä¸‹ç¦æ­¢åˆ›å»ºä»»ä½• .md æ–‡æ¡£æ–‡ä»¶
- **ä¸“æ³¨ä»£ç å®ç°**ï¼šæ’ä»¶åŠŸèƒ½æ›´æ–°æ—¶åªä¿®æ”¹ä»£ç ï¼Œä¸åˆ›å»ºè¯´æ˜æ–‡æ¡£ 

## ç½‘ç«™è®¾è®¡è§„èŒƒ (vige-web) â­ æå…¶é‡è¦

### è®¾è®¡ç†å¿µä¸åŸåˆ™ ğŸ¨

#### æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š
- **Apple Design é£æ ¼**ï¼šç®€æ´ã€ä¼˜é›…ã€åŠŸèƒ½æ€§è‡³ä¸Š
- **ç§‘æŠ€æ„Ÿä¸æœªæ¥æ„Ÿ**ï¼šä½“ç°AIç¿»è¯‘å¹³å°çš„ä¸“ä¸šæ€§å’Œå…ˆè¿›æ€§
- **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼šç›´è§‚æ˜“ç”¨ï¼Œå‡å°‘ç”¨æˆ·å­¦ä¹ æˆæœ¬
- **ä¸€è‡´æ€§åŸåˆ™**ï¼šç»Ÿä¸€çš„è§†è§‰è¯­è¨€å’Œäº¤äº’æ¨¡å¼

#### è®¾è®¡åŸåˆ™ï¼š
1. **ç®€æ´è‡³ä¸Š**ï¼šå»é™¤ä¸å¿…è¦çš„è£…é¥°ï¼Œçªå‡ºæ ¸å¿ƒåŠŸèƒ½
2. **å±‚æ¬¡æ¸…æ™°**ï¼šé€šè¿‡è§†è§‰å±‚çº§å¼•å¯¼ç”¨æˆ·æ³¨æ„åŠ›
3. **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§è®¾å¤‡å’Œå±å¹•å°ºå¯¸
4. **æ— éšœç¢è®¾è®¡**ï¼šç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½æ­£å¸¸ä½¿ç”¨
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¿«é€ŸåŠ è½½ï¼Œæµç•…äº¤äº’

### è‰²å½©ç³»ç»Ÿ ğŸŒˆ

#### ä¸»è‰²è°ƒï¼š
```less
// ä¸»å“ç‰Œè‰² - ç§‘æŠ€è“
@primary-color: #007AFF;          // Apple ç³»ç»Ÿè“
@primary-light: #5AC8FA;          // æµ…è“è‰²
@primary-dark: #0051D5;           // æ·±è“è‰²

// è¾…åŠ©è‰²è°ƒ
@secondary-color: #5856D6;        // ç´«è‰²ï¼Œç”¨äºå¼ºè°ƒ
@accent-color: #FF9500;           // æ©™è‰²ï¼Œç”¨äºè­¦ç¤ºå’Œäº®ç‚¹

// ä¸­æ€§è‰²ç³» - Apple é£æ ¼ç°åº¦
@text-primary: #000000;           // ä¸»è¦æ–‡å­—
@text-secondary: #3C3C43;         // æ¬¡è¦æ–‡å­— (60% opacity)
@text-tertiary: #3C3C4399;       // ä¸‰çº§æ–‡å­— (40% opacity)
@text-placeholder: #3C3C434D;     // å ä½ç¬¦æ–‡å­— (30% opacity)

// èƒŒæ™¯è‰²ç³»
@bg-primary: #FFFFFF;             // ä¸»èƒŒæ™¯
@bg-secondary: #F2F2F7;           // æ¬¡è¦èƒŒæ™¯
@bg-tertiary: #FFFFFF;            // å¡ç‰‡èƒŒæ™¯
@bg-elevated: #FFFFFF;            // æ‚¬æµ®èƒŒæ™¯

// åˆ†å‰²çº¿å’Œè¾¹æ¡†
@separator-color: #3C3C4329;      // åˆ†å‰²çº¿ (16% opacity)
@border-color: #3C3C432E;         // è¾¹æ¡† (18% opacity)

// è¯­ä¹‰åŒ–é¢œè‰²
@success-color: #34C759;          // æˆåŠŸç»¿
@warning-color: #FF9500;          // è­¦å‘Šæ©™
@error-color: #FF3B30;            // é”™è¯¯çº¢
@info-color: #007AFF;             // ä¿¡æ¯è“
```

#### æ·±è‰²æ¨¡å¼æ”¯æŒï¼š
```less
// æ·±è‰²æ¨¡å¼è‰²å½©ï¼ˆå¯é€‰å®ç°ï¼‰
@dark-bg-primary: #000000;
@dark-bg-secondary: #1C1C1E;
@dark-bg-tertiary: #2C2C2E;
@dark-text-primary: #FFFFFF;
@dark-text-secondary: #EBEBF599;
```

### å­—ä½“ç³»ç»Ÿ ğŸ“

#### å­—ä½“æ—ï¼š
```less
// Apple ç³»ç»Ÿå­—ä½“æ ˆ
@font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;

// ç­‰å®½å­—ä½“ï¼ˆç”¨äºä»£ç æ˜¾ç¤ºï¼‰
@font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
```

#### å­—å·å±‚çº§ï¼š
```less
// æ ‡é¢˜å­—å·
@font-size-h1: 34px;              // å¤§æ ‡é¢˜
@font-size-h2: 28px;              // äºŒçº§æ ‡é¢˜  
@font-size-h3: 22px;              // ä¸‰çº§æ ‡é¢˜
@font-size-h4: 20px;              // å››çº§æ ‡é¢˜
@font-size-h5: 18px;              // äº”çº§æ ‡é¢˜
@font-size-h6: 16px;              // å…­çº§æ ‡é¢˜

// æ­£æ–‡å­—å·
@font-size-large: 17px;           // å¤§å·æ­£æ–‡
@font-size-base: 15px;            // åŸºç¡€æ­£æ–‡
@font-size-small: 13px;           // å°å·æ–‡å­—
@font-size-mini: 11px;            // æœ€å°æ–‡å­—

// å­—é‡
@font-weight-light: 300;          // ç»†ä½“
@font-weight-normal: 400;         // å¸¸è§„
@font-weight-medium: 500;         // ä¸­ç­‰
@font-weight-semibold: 600;       // åŠç²—ä½“
@font-weight-bold: 700;           // ç²—ä½“
```

#### è¡Œé«˜è§„èŒƒï¼š
```less
@line-height-tight: 1.2;          // ç´§å‡‘è¡Œé«˜ï¼ˆæ ‡é¢˜ï¼‰
@line-height-base: 1.4;           // åŸºç¡€è¡Œé«˜ï¼ˆæ­£æ–‡ï¼‰
@line-height-relaxed: 1.6;        // å®½æ¾è¡Œé«˜ï¼ˆé•¿æ–‡æœ¬ï¼‰
```

### é—´è·ç³»ç»Ÿ ğŸ“

#### åŸºç¡€é—´è·å•ä½ï¼š
```less
// 4px åŸºç¡€ç½‘æ ¼ç³»ç»Ÿ
@spacing-xs: 4px;                 // è¶…å°é—´è·
@spacing-sm: 8px;                 // å°é—´è·
@spacing-md: 16px;                // ä¸­ç­‰é—´è·
@spacing-lg: 24px;                // å¤§é—´è·
@spacing-xl: 32px;                // è¶…å¤§é—´è·
@spacing-xxl: 48px;               // ç‰¹å¤§é—´è·

// ç»„ä»¶å†…é—´è·
@padding-xs: 8px;
@padding-sm: 12px;
@padding-md: 16px;
@padding-lg: 20px;
@padding-xl: 24px;

// é¡µé¢çº§é—´è·
@container-padding: 20px;         // å®¹å™¨å†…è¾¹è·
@section-spacing: 40px;           // åŒºå—é—´è·
```

### åœ†è§’å’Œé˜´å½±ç³»ç»Ÿ ğŸ”²

#### åœ†è§’è§„èŒƒï¼š
```less
@border-radius-sm: 6px;           // å°åœ†è§’
@border-radius-md: 8px;           // ä¸­ç­‰åœ†è§’
@border-radius-lg: 12px;          // å¤§åœ†è§’
@border-radius-xl: 16px;          // è¶…å¤§åœ†è§’
@border-radius-round: 50%;        // åœ†å½¢
```

#### é˜´å½±ç³»ç»Ÿï¼š
```less
// Apple é£æ ¼é˜´å½±
@shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
@shadow-md: 0 3px 6px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.12);
@shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.10);
@shadow-xl: 0 15px 25px rgba(0, 0, 0, 0.15), 0 5px 10px rgba(0, 0, 0, 0.05);

// ç‰¹æ®Šé˜´å½±
@shadow-inset: inset 0 1px 2px rgba(0, 0, 0, 0.1);
@shadow-focus: 0 0 0 3px rgba(0, 122, 255, 0.3);
```

### ç»„ä»¶è®¾è®¡è§„èŒƒ ğŸ§©

#### æŒ‰é’®æ ·å¼ï¼š
```less
// ä¸»è¦æŒ‰é’®
.btn-primary {
  background: @primary-color;
  color: #FFFFFF;
  border: none;
  border-radius: @border-radius-md;
  padding: 12px 20px;
  font-size: @font-size-base;
  font-weight: @font-weight-medium;
  transition: all 0.2s ease;
  
  &:hover {
    background: @primary-dark;
    transform: translateY(-1px);
    box-shadow: @shadow-md;
  }
  
  &:active {
    transform: translateY(0);
    box-shadow: @shadow-sm;
  }
}

// æ¬¡è¦æŒ‰é’®
.btn-secondary {
  background: @bg-secondary;
  color: @primary-color;
  border: 1px solid @border-color;
  border-radius: @border-radius-md;
  padding: 12px 20px;
  font-size: @font-size-base;
  font-weight: @font-weight-medium;
  transition: all 0.2s ease;
  
  &:hover {
    background: @primary-color;
    color: #FFFFFF;
    border-color: @primary-color;
  }
}

// æ–‡å­—æŒ‰é’®
.btn-text {
  background: transparent;
  color: @primary-color;
  border: none;
  padding: 8px 12px;
  font-size: @font-size-base;
  font-weight: @font-weight-medium;
  transition: all 0.2s ease;
  
  &:hover {
    background: rgba(0, 122, 255, 0.1);
    border-radius: @border-radius-sm;
  }
}
```

#### å¡ç‰‡ç»„ä»¶ï¼š
```less
.card {
  background: @bg-tertiary;
  border-radius: @border-radius-lg;
  box-shadow: @shadow-sm;
  padding: @padding-lg;
  transition: all 0.3s ease;
  
  &:hover {
    box-shadow: @shadow-md;
    transform: translateY(-2px);
  }
  
  .card-header {
    margin-bottom: @spacing-md;
    padding-bottom: @spacing-md;
    border-bottom: 1px solid @separator-color;
  }
  
  .card-title {
    font-size: @font-size-h5;
    font-weight: @font-weight-semibold;
    color: @text-primary;
    margin: 0;
  }
  
  .card-content {
    color: @text-secondary;
    line-height: @line-height-base;
  }
}
```

#### è¡¨å•å…ƒç´ ï¼š
```less
.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid @border-color;
  border-radius: @border-radius-md;
  font-size: @font-size-base;
  color: @text-primary;
  background: @bg-primary;
  transition: all 0.2s ease;
  
  &:focus {
    outline: none;
    border-color: @primary-color;
    box-shadow: @shadow-focus;
  }
  
  &::placeholder {
    color: @text-placeholder;
  }
}

.form-label {
  display: block;
  margin-bottom: @spacing-xs;
  font-size: @font-size-small;
  font-weight: @font-weight-medium;
  color: @text-secondary;
}
```

### ç¤ºä¾‹ç»„ä»¶ï¼ˆå¯é€‰ï¼‰ ğŸ¤–

#### æ–‡æ¡£ä¸Šä¼ åŒºåŸŸï¼š
```less
.upload-area {
  border: 2px dashed @border-color;
  border-radius: @border-radius-lg;
  padding: @spacing-xxl;
  text-align: center;
  background: @bg-secondary;
  transition: all 0.3s ease;
  cursor: pointer;
  
  &:hover, &.drag-over {
    border-color: @primary-color;
    background: rgba(0, 122, 255, 0.05);
  }
  
  .upload-icon {
    font-size: 48px;
    color: @text-tertiary;
    margin-bottom: @spacing-md;
  }
  
  .upload-text {
    font-size: @font-size-large;
    color: @text-secondary;
    margin-bottom: @spacing-sm;
  }
  
  .upload-hint {
    font-size: @font-size-small;
    color: @text-tertiary;
  }
}
```

#### è¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆç¤ºä¾‹ï¼‰ï¼š
```less
.translation-progress {
  background: @bg-tertiary;
  border-radius: @border-radius-lg;
  padding: @padding-lg;
  box-shadow: @shadow-sm;
  
  .progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: @spacing-md;
  }
  
  .progress-title {
    font-size: @font-size-base;
    font-weight: @font-weight-medium;
    color: @text-primary;
  }
  
  .progress-percentage {
    font-size: @font-size-small;
    color: @text-secondary;
  }
  
  .progress-bar {
    height: 6px;
    background: @bg-secondary;
    border-radius: 3px;
    overflow: hidden;
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, @primary-color, @primary-light);
      border-radius: 3px;
      transition: width 0.3s ease;
    }
  }
}
```

#### ç»“æœå±•ç¤ºï¼ˆç¤ºä¾‹ï¼‰ï¼š
```less
.translation-result {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: @spacing-lg;
  margin-top: @spacing-lg;
  
  .result-panel {
    background: @bg-tertiary;
    border-radius: @border-radius-lg;
    padding: @padding-lg;
    box-shadow: @shadow-sm;
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: @spacing-md;
      padding-bottom: @spacing-sm;
      border-bottom: 1px solid @separator-color;
    }
    
    .panel-title {
      font-size: @font-size-base;
      font-weight: @font-weight-medium;
      color: @text-primary;
    }
    
    .panel-actions {
      display: flex;
      gap: @spacing-sm;
    }
    
    .panel-content {
      font-size: @font-size-base;
      line-height: @line-height-base;
      color: @text-secondary;
    }
  }
  
  // å“åº”å¼å¸ƒå±€
  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}
```

### åŠ¨æ•ˆå’Œäº¤äº’è§„èŒƒ âœ¨

#### è¿‡æ¸¡åŠ¨ç”»ï¼š
```less
// åŸºç¡€è¿‡æ¸¡
@transition-fast: 0.15s ease;
@transition-base: 0.2s ease;
@transition-slow: 0.3s ease;

// ç¼“åŠ¨å‡½æ•°
@ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
@ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);

// é€šç”¨è¿‡æ¸¡ç±»
.transition-all {
  transition: all @transition-base;
}

.transition-transform {
  transition: transform @transition-base @ease-out-quart;
}

.transition-opacity {
  transition: opacity @transition-base;
}
```

#### å¾®äº¤äº’æ•ˆæœï¼š
```less
// æ‚¬æµ®æ•ˆæœ
.hover-lift {
  transition: transform @transition-base @ease-out-quart;
  
  &:hover {
    transform: translateY(-2px);
  }
}

// ç‚¹å‡»åé¦ˆ
.click-feedback {
  transition: transform @transition-fast;
  
  &:active {
    transform: scale(0.98);
  }
}

// åŠ è½½åŠ¨ç”»
@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.loading-pulse {
  animation: pulse 2s infinite;
}
```

### å“åº”å¼è®¾è®¡ ğŸ“±

#### æ–­ç‚¹ç³»ç»Ÿï¼š
```less
// æ–­ç‚¹å®šä¹‰
@screen-xs: 480px;
@screen-sm: 768px;
@screen-md: 992px;
@screen-lg: 1200px;
@screen-xl: 1600px;

// åª’ä½“æŸ¥è¯¢ Mixin
.responsive(@size, @rules) {
  @media (max-width: @size) {
    @rules();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 @container-padding;
  
  .responsive(@screen-md, {
    padding: 0 @spacing-md;
  });
  
  .responsive(@screen-sm, {
    padding: 0 @spacing-sm;
  });
}
```

### CSS/Less ç»„ç»‡ç»“æ„ ğŸ“

#### æ–‡ä»¶ç»„ç»‡ï¼š
```
styles/
â”œâ”€â”€ variables/           # å˜é‡å®šä¹‰
â”‚   â”œâ”€â”€ colors.less     # é¢œè‰²å˜é‡
â”‚   â”œâ”€â”€ typography.less # å­—ä½“å˜é‡
â”‚   â”œâ”€â”€ spacing.less    # é—´è·å˜é‡
â”‚   â””â”€â”€ breakpoints.less # æ–­ç‚¹å˜é‡
â”œâ”€â”€ mixins/             # æ··å…¥å‡½æ•°
â”‚   â”œâ”€â”€ buttons.less    # æŒ‰é’®æ··å…¥
â”‚   â”œâ”€â”€ cards.less      # å¡ç‰‡æ··å…¥
â”‚   â””â”€â”€ responsive.less # å“åº”å¼æ··å…¥
â”œâ”€â”€ components/         # ç»„ä»¶æ ·å¼
â”‚   â”œâ”€â”€ buttons.less    # æŒ‰é’®ç»„ä»¶
â”‚   â”œâ”€â”€ forms.less      # è¡¨å•ç»„ä»¶
â”‚   â”œâ”€â”€ cards.less      # å¡ç‰‡ç»„ä»¶
â”‚   â””â”€â”€ upload.less     # ä¸Šä¼ ç»„ä»¶
â”œâ”€â”€ pages/             # é¡µé¢æ ·å¼
â”‚   â”œâ”€â”€ home.less      # é¦–é¡µæ ·å¼
â”‚   â”œâ”€â”€ translate.less # ç¿»è¯‘é¡µæ ·å¼
â”‚   â””â”€â”€ profile.less   # ä¸ªäººä¸­å¿ƒæ ·å¼
â”œâ”€â”€ layout/            # å¸ƒå±€æ ·å¼
â”‚   â”œâ”€â”€ header.less    # å¤´éƒ¨æ ·å¼
â”‚   â”œâ”€â”€ sidebar.less   # ä¾§è¾¹æ æ ·å¼
â”‚   â””â”€â”€ footer.less    # åº•éƒ¨æ ·å¼
â””â”€â”€ base/              # åŸºç¡€æ ·å¼
    â”œâ”€â”€ reset.less     # æ ·å¼é‡ç½®
    â”œâ”€â”€ typography.less # å­—ä½“æ ·å¼
    â””â”€â”€ utilities.less  # å·¥å…·ç±»
```

#### å‘½åè§„èŒƒï¼š
```less
// BEM å‘½åæ–¹æ³•
.block {}                    // å—
.block__element {}           // å…ƒç´ 
.block--modifier {}          // ä¿®é¥°ç¬¦
.block__element--modifier {} // å…ƒç´ ä¿®é¥°ç¬¦

// ç¤ºä¾‹
.translation-card {}                    // ç¿»è¯‘å¡ç‰‡
.translation-card__header {}            // å¡ç‰‡å¤´éƒ¨
.translation-card__content {}           // å¡ç‰‡å†…å®¹
.translation-card--loading {}           // åŠ è½½çŠ¶æ€
.translation-card__header--highlighted {} // é«˜äº®å¤´éƒ¨
```

### ä»£ç è§„èŒƒ ğŸ“‹

#### Less ç¼–å†™è§„èŒƒï¼š
```less
// âœ… æ­£ç¡®çš„æ ·å¼ç¼–å†™æ–¹å¼
.translation-page {
  padding: @spacing-lg;
  background: @bg-primary;
  
  .page-header {
    margin-bottom: @spacing-xl;
    text-align: center;
    
    .page-title {
      font-size: @font-size-h2;
      font-weight: @font-weight-semibold;
      color: @text-primary;
      margin-bottom: @spacing-md;
    }
    
    .page-description {
      font-size: @font-size-base;
      color: @text-secondary;
      line-height: @line-height-base;
    }
  }
  
  .page-content {
    max-width: 800px;
    margin: 0 auto;
  }
  
  // å“åº”å¼è®¾è®¡
  @media (max-width: @screen-md) {
    padding: @spacing-md;
    
    .page-header .page-title {
      font-size: @font-size-h3;
    }
  }
}
```

#### ç»„ä»¶å¼€å‘è§„èŒƒï¼š
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **å¯å¤ç”¨æ€§**ï¼šè®¾è®¡é€šç”¨çš„ç»„ä»¶æ¥å£
3. **ä¸€è‡´æ€§**ï¼šéµå¾ªç»Ÿä¸€çš„è®¾è®¡è§„èŒƒ
4. **å¯è®¿é—®æ€§**ï¼šæ”¯æŒé”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„é‡ç»˜å’Œå›æµ

#### å¼€å‘æ£€æŸ¥æ¸…å•ï¼š
- âœ… ä½¿ç”¨è®¾è®¡ç³»ç»Ÿä¸­å®šä¹‰çš„é¢œè‰²å˜é‡
- âœ… éµå¾ªå­—ä½“å’Œé—´è·è§„èŒƒ
- âœ… å®ç°å“åº”å¼è®¾è®¡
- âœ… æ·»åŠ é€‚å½“çš„è¿‡æ¸¡åŠ¨ç”»
- âœ… ç¡®ä¿ç»„ä»¶çš„å¯è®¿é—®æ€§
- âœ… ä½¿ç”¨ BEM å‘½åè§„èŒƒ
- âœ… ä¼˜åŒ–æ€§èƒ½å’ŒåŠ è½½é€Ÿåº¦
- âŒ ä¸è¦ç¡¬ç¼–ç é¢œè‰²å€¼
- âŒ ä¸è¦ä½¿ç”¨å†…è”æ ·å¼
- âŒ ä¸è¦å¿½ç•¥ç§»åŠ¨ç«¯é€‚é…

### ç‰¹æ®Šé¡µé¢è®¾è®¡æŒ‡å— ğŸ“„

#### é¦–é¡µè®¾è®¡ï¼š
- **è‹±é›„åŒºåŸŸ**ï¼šçªå‡ºAIç¿»è¯‘çš„æ ¸å¿ƒä»·å€¼
- **åŠŸèƒ½å±•ç¤º**ï¼šæ¸…æ™°å±•ç¤ºä¸»è¦åŠŸèƒ½ç‰¹æ€§
- **ä¸Šä¼ å…¥å£**ï¼šæ˜¾çœ¼çš„æ–‡æ¡£ä¸Šä¼ åŒºåŸŸ
- **ä¿¡ä»»å»ºç«‹**ï¼šå±•ç¤ºå®‰å…¨æ€§å’Œå‡†ç¡®æ€§

#### ç¿»è¯‘é¡µé¢è®¾è®¡ï¼š
- **åŒæ å¸ƒå±€**ï¼šåŸæ–‡å’Œè¯‘æ–‡å¹¶åˆ—å±•ç¤º
- **å·¥å…·æ **ï¼šæä¾›å¤åˆ¶ã€ä¸‹è½½ã€åˆ†äº«ç­‰åŠŸèƒ½
- **è¿›åº¦æŒ‡ç¤º**ï¼šæ¸…æ™°æ˜¾ç¤ºç¿»è¯‘è¿›åº¦
- **é”™è¯¯å¤„ç†**ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’Œé‡è¯•æœºåˆ¶

#### ä¸ªäººä¸­å¿ƒè®¾è®¡ï¼š
- **ä¿¡æ¯æ¦‚è§ˆ**ï¼šç”¨æˆ·ä¿¡æ¯å’Œä½¿ç”¨ç»Ÿè®¡
- **å†å²è®°å½•**ï¼šç¿»è¯‘å†å²çš„ç®¡ç†å’ŒæŸ¥çœ‹
- **è®¾ç½®é€‰é¡¹**ï¼šä¸ªæ€§åŒ–è®¾ç½®å’Œåå¥½é…ç½®

### Lessè¯­æ³•è§„èŒƒ âš ï¸ é‡è¦

#### calc()å‡½æ•°ä½¿ç”¨è§„èŒƒï¼š
åœ¨Lessä¸­ä½¿ç”¨`calc()`æ—¶å¿…é¡»ä½¿ç”¨è½¬ä¹‰è¯­æ³•ï¼Œé˜²æ­¢Lessé¢„å¤„ç†å™¨è¯•å›¾è®¡ç®—è¡¨è¾¾å¼ï¼š

```less
// âŒ é”™è¯¯ï¼šLessä¼šå°è¯•è®¡ç®—è¡¨è¾¾å¼ï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯
.container {
  height: calc(100vh - 80px);
  min-height: calc(100% - 40px);
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨è½¬ä¹‰è¯­æ³•ï¼Œå‘Šè¯‰Lessä¸è¦å¤„ç†è¿™ä¸ªå­—ç¬¦ä¸²
.container {
  height: ~"calc(100vh - 80px)";
  min-height: ~"calc(100% - 40px)";
}
```

#### å¸¸è§calcä½¿ç”¨åœºæ™¯ï¼š
```less
// è§†å£é«˜åº¦è®¡ç®—
.main-content {
  min-height: ~"calc(100vh - 80px)";
}

// å®¹å™¨å®½åº¦è®¡ç®—
.sidebar {
  width: ~"calc(100% - 280px)";
}

// å¤æ‚è¡¨è¾¾å¼
.content-area {
  height: ~"calc(100vh - 140px)";
  padding: ~"calc(20px + 1rem)";
}
```

#### é‡è¦æ³¨æ„äº‹é¡¹ï¼š
1. **å¿…é¡»ä½¿ç”¨è½¬ä¹‰**: æ‰€æœ‰åŒ…å«è®¡ç®—çš„calcè¡¨è¾¾å¼éƒ½è¦ç”¨`~"calc(...)"`
2. **ä¿æŒä¸€è‡´æ€§**: é¡¹ç›®ä¸­ç»Ÿä¸€ä½¿ç”¨è¿™ç§è¯­æ³•
3. **ç¼–è¯‘æ£€æŸ¥**: å¦‚æœå‡ºç°calcç›¸å…³ç¼–è¯‘é”™è¯¯ï¼Œæ£€æŸ¥æ˜¯å¦ç¼ºå°‘è½¬ä¹‰è¯­æ³•
4. **é¿å…æ··ç”¨**: ä¸è¦åœ¨åŒä¸€é¡¹ç›®ä¸­æ··ç”¨è½¬ä¹‰å’Œéè½¬ä¹‰çš„calcè¯­æ³•

### ESè¯­æ³•å…¼å®¹æ€§è§„èŒƒ âš ï¸ æå…¶é‡è¦ 

## åˆ†æ­¥éª¤å¼€å‘è§„èŒƒ âš ï¸ æå…¶é‡è¦

### æ ¸å¿ƒåŸåˆ™ï¼š
åˆ†æ­¥éª¤ã€æ¨¡å—åŒ–çš„å¼€å‘æ–¹å¼ï¼Œç¡®ä¿æ¯ä¸€æ­¥éƒ½ç»è¿‡ç¡®è®¤å†è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œé¿å…å¤§è§„æ¨¡è¿”å·¥ã€‚

### å¼€å‘æµç¨‹è§„èŒƒï¼š

#### 1. æ¨¡å—å¼€å‘æ­¥éª¤ â­ å¿…é¡»éµå¾ª
æ¯ä¸ªæ–°åŠŸèƒ½æˆ–æ¨¡å—çš„å¼€å‘å¿…é¡»æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼Œ**æ¯å®Œæˆä¸€æ­¥éƒ½è¦ç­‰å¾…ç”¨æˆ·ç¡®è®¤**ï¼š

```
æ­¥éª¤1: æ•°æ®æ¨¡å‹è®¾è®¡ (models.py + constants.py)
   â†“ ç­‰å¾…ç¡®è®¤
æ­¥éª¤2: è¡¨å•éªŒè¯è®¾è®¡ (forms.py)  
   â†“ ç­‰å¾…ç¡®è®¤
æ­¥éª¤3: å“åº”æ¨¡å‹è®¾è®¡ (schemas.py)
   â†“ ç­‰å¾…ç¡®è®¤
æ­¥éª¤4: APIæ¥å£å®ç° (api.py)
   â†“ ç­‰å¾…ç¡®è®¤
æ­¥éª¤5: åå°ä»»åŠ¡å®ç° (tasks.py)
   â†“ ç­‰å¾…ç¡®è®¤
æ­¥éª¤6: ä¸šåŠ¡é€»è¾‘é›†æˆå’Œæµ‹è¯•
```

#### 2. å•æ­¥éª¤å®Œæ•´å®ç°åŸåˆ™ â­ æ ¸å¿ƒ
- **æœ€å°åŠŸèƒ½å•å…ƒ**ï¼šæ¯æ¬¡åªå®ç°ä¸€ä¸ªå®Œæ•´çš„æœ€å°åŠŸèƒ½æ¿å—
- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šç¡®ä¿æ¯ä¸€æ­¥å®ç°çš„åŠŸèƒ½åœ¨å…¶èŒƒå›´å†…æ˜¯å®Œæ•´å¯ç”¨çš„
- **é€»è¾‘æ¸…æ™°**ï¼šæ¯ä¸€æ­¥çš„ä»£ç é€»è¾‘è¦å®Œæ•´ã€æ­£ç¡®ã€ç¬¦åˆé¢„æœŸ
- **ä¾èµ–æ˜ç¡®**ï¼šæ¯ä¸€æ­¥è¦æ˜ç¡®å…¶ä¾èµ–å…³ç³»å’Œæ¥å£å®šä¹‰

#### 3. ä»£ç æäº¤è§„èŒƒï¼š
```python
# âœ… æ­£ç¡®ï¼šå•ä¸€èŒè´£ï¼ŒåŠŸèƒ½å®Œæ•´
# ç¬¬ä¸€æ­¥ï¼šåªå®ç°æ•°æ®æ¨¡å‹
class IMConversation(CRUDMixin, TrackableMixin):
    """IMä¼šè¯è¡¨"""
    pass

# âœ… æ­£ç¡®ï¼šç¬¬äºŒæ­¥æ‰å®ç°è¡¨å•
class IMMessageForm(BaseModel):
    """IMæ¶ˆæ¯è¡¨å•"""
    pass

# âŒ é”™è¯¯ï¼šä¸€æ¬¡æ€§å®ç°æ‰€æœ‰æ–‡ä»¶
# ä¸è¦åŒæ—¶æäº¤ models.py + forms.py + api.py + tasks.py
```

#### 4. ç¡®è®¤èŠ‚ç‚¹è§„èŒƒï¼š
æ¯ä¸ªæ­¥éª¤å®Œæˆåï¼Œå¿…é¡»ï¼š
- **å±•ç¤ºå®Œæ•´ä»£ç **ï¼šæ˜¾ç¤ºå½“å‰æ­¥éª¤çš„æ‰€æœ‰å®ç°ä»£ç 
- **è¯´æ˜å®ç°é€»è¾‘**ï¼šè§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜
- **åˆ—å‡ºä¸‹ä¸€æ­¥è®¡åˆ’**ï¼šæ˜ç¡®ä¸‹ä¸€æ­¥è¦å®ç°ä»€ä¹ˆ
- **ç­‰å¾…æ˜ç¡®ç¡®è®¤**ï¼šç”¨æˆ·æ˜ç¡®è¡¨ç¤º"ç»§ç»­ä¸‹ä¸€æ­¥"æˆ–"ä¿®æ”¹å½“å‰æ­¥éª¤"

#### 5. é”™è¯¯å¤„ç†å’Œä¿®æ­£è§„èŒƒï¼š
- **åŠæ—¶ä¿®æ­£**ï¼šå¦‚æœå½“å‰æ­¥éª¤ä¸ç¬¦åˆé¢„æœŸï¼Œç«‹å³ä¿®æ­£ï¼Œä¸è¦ç»§ç»­ä¸‹ä¸€æ­¥
- **å±€éƒ¨ä¿®æ”¹**ï¼šåªä¿®æ”¹å½“å‰æ­¥éª¤çš„ä»£ç ï¼Œä¸è¦å½±å“å·²ç¡®è®¤çš„å‰åºæ­¥éª¤
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½è¦ä¿æŒä»£ç çš„å®Œæ•´æ€§å’Œå¯è¿½æº¯æ€§

#### 6. ç¦æ­¢è¡Œä¸º âŒï¼š
- âŒ **ä¸è¦ä¸€æ¬¡æ€§å®Œæˆå¤šä¸ªæ­¥éª¤**ï¼šé¿å…å¤§è§„æ¨¡ä»£ç æäº¤
- âŒ **ä¸è¦è·¨æ­¥éª¤å®ç°**ï¼šä¸è¦åœ¨å®ç°models.pyæ—¶åŒæ—¶å†™api.pyçš„ä»£ç 
- âŒ **ä¸è¦å‡è®¾ç¡®è®¤**ï¼šæ²¡æœ‰å¾—åˆ°æ˜ç¡®ç¡®è®¤ä¸è¦è¿›è¡Œä¸‹ä¸€æ­¥
- âŒ **ä¸è¦è°ƒç”¨æµ‹è¯•å·¥å…·**ï¼šé¿å…è¿è¡Œå‘½ä»¤ã€eslintä¿®å¤ã€æµ‹è¯•è„šæœ¬ç­‰æ“ä½œ
- âŒ **ä¸è¦å†™æµ‹è¯•ä»£ç **ï¼šä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°ï¼Œä¸å†™å•å…ƒæµ‹è¯•

#### 7. æ¨èåšæ³• âœ…ï¼š
- âœ… **å•ä¸€èŒè´£**ï¼šæ¯æ¬¡åªå…³æ³¨ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªåŠŸèƒ½æ¨¡å—
- âœ… **æ¸è¿›å®ç°**ï¼šä»æ•°æ®å±‚åˆ°è¡¨ç¤ºå±‚ï¼Œè‡ªåº•å‘ä¸Šå®ç°
- âœ… **å®Œæ•´å±•ç¤º**ï¼šæ¯æ­¥å®Œæˆåå±•ç¤ºå®Œæ•´çš„ä»£ç å®ç°
- âœ… **é€»è¾‘è¯´æ˜**ï¼šè§£é‡Šè®¾è®¡æ€è·¯å’Œå®ç°æ–¹æ¡ˆ
- âœ… **ä¾èµ–æ¢³ç†**ï¼šæ˜ç¡®å½“å‰æ­¥éª¤ä¸å…¶ä»–æ¨¡å—çš„ä¾èµ–å…³ç³»

#### 8. æ²Ÿé€šæ¨¡æ¿ï¼š
```
## ç¬¬Næ­¥å®Œæˆï¼š[åŠŸèƒ½åç§°]

### å®ç°å†…å®¹ï¼š
[å®Œæ•´ä»£ç å±•ç¤º]

### è®¾è®¡è¯´æ˜ï¼š
[è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡]

### ä¸‹ä¸€æ­¥è®¡åˆ’ï¼š
[æ˜ç¡®ä¸‹ä¸€æ­¥è¦å®ç°çš„å†…å®¹]

### ç­‰å¾…ç¡®è®¤ï¼š
è¯·ç¡®è®¤å½“å‰å®ç°æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥ï¼Ÿ
```

#### 9. ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼š
- **å¤æ‚æ¨¡å—æ‹†åˆ†**ï¼šå¦‚æœå•ä¸ªæ–‡ä»¶è¿‡äºå¤æ‚ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†æ­¥éª¤
- **ä¾èµ–æ¨¡å—ä¼˜å…ˆ**ï¼šå…ˆå®ç°è¢«ä¾èµ–çš„åŸºç¡€æ¨¡å—ï¼Œå†å®ç°ä¾èµ–æ¨¡å—
- **é…ç½®é¡¹åˆ†ç¦»**ï¼šé…ç½®ç›¸å…³çš„ä¿®æ”¹ä½œä¸ºç‹¬ç«‹æ­¥éª¤å¤„ç†

### å¼€å‘æ•ˆç‡ä¿éšœï¼š
é€šè¿‡è¿™ç§åˆ†æ­¥éª¤çš„æ–¹å¼ï¼Œå¯ä»¥ï¼š
1. **å‡å°‘è¿”å·¥**ï¼šæ¯æ­¥ç¡®è®¤é¿å…å¤§è§„æ¨¡ä¿®æ”¹
2. **æé«˜è´¨é‡**ï¼šä¸“æ³¨å•ä¸€åŠŸèƒ½ç¡®ä¿å®ç°è´¨é‡  
3. **ä¾¿äºè°ƒè¯•**ï¼šé—®é¢˜å®šä½æ›´ç²¾å‡†
4. **é™ä½é£é™©**ï¼šé¿å…å¤æ‚é€»è¾‘é”™è¯¯ä¼ æ’­
5. **æå‡æ²Ÿé€š**ï¼šæ¯æ­¥éƒ½æœ‰æ˜ç¡®çš„äº¤ä»˜å’Œç¡®è®¤ç‚¹

## FastAPI Pathå‚æ•°å®šä¹‰è§„èŒƒï¼ˆæŒ‰ Python è¯­æ³•è¦æ±‚ï¼‰

### æ ¸å¿ƒé—®é¢˜ï¼š
åœ¨FastAPIä¸­å®šä¹‰Pathå‚æ•°æ—¶ï¼Œ**ç»å¯¹ä¸èƒ½ä¸ºPathå‚æ•°è®¾ç½®é»˜è®¤å€¼è¯­æ³•**ï¼Œè¿™ä¼šå¯¼è‡´ `non-default parameter follows default parameter` è¯­æ³•é”™è¯¯ã€‚

### é”™è¯¯åšæ³•ï¼ˆä¸¥ç¦ï¼‰ï¼š
```python
# âŒ é”™è¯¯ï¼šPathå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼è¯­æ³•
async def get_task(
    task_id: int = Path(..., description="ä»»åŠ¡ID", example=1, gt=0),  # é”™è¯¯ï¼
    form: FilterForm = Depends(),  # è¿™ä¸ªæœ‰é»˜è®¤å€¼ï¼Œæ”¾åœ¨Pathå‚æ•°åé¢ä¼šæŠ¥é”™
    current_user: User = Depends(get_user)
):
    pass
```

### æ­£ç¡®åšæ³•ï¼š
```python
# âœ… æ­£ç¡®ï¼šPathå‚æ•°ä½¿ç”¨ç®€å•ç±»å‹æ³¨è§£
async def get_task(
    task_id: int,  # ç®€å•æ–¹å¼ï¼šç›´æ¥å®šä¹‰ç±»å‹ï¼ŒFastAPIè‡ªåŠ¨è¯†åˆ«ä¸ºPathå‚æ•°
    form: FilterForm = Depends(),
    current_user: User = Depends(get_user)
):
    pass

# âœ… æ­£ç¡®ï¼šå¦‚æœéœ€è¦ä½¿ç”¨Path()éªŒè¯ï¼Œè°ƒæ•´å‚æ•°é¡ºåº
async def get_task(
    form: FilterForm = Depends(),
    current_user: User = Depends(get_user),
    task_id: int = Path(..., description="ä»»åŠ¡ID", example=1, gt=0)  # æ”¾åœ¨æœ€å
):
    pass
```

### å‚æ•°é¡ºåºè§„èŒƒï¼š
1. **å¿…éœ€å‚æ•°ï¼ˆæ— é»˜è®¤å€¼ï¼‰**ï¼šå¦‚ç®€å•Pathå‚æ•°ã€å¿…éœ€çš„è¡¨å•å‚æ•°
2. **å¯é€‰å‚æ•°ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰**ï¼šå¦‚Depends()ã€Query()ã€Path()ç­‰

### æ¨èçš„å‚æ•°å®šä¹‰æ¨¡å¼ï¼š
```python
# âœ… æœ€ä½³å®è·µï¼šç®€æ´çš„Pathå‚æ•°å®šä¹‰
async def get_translation_task(
    task_id: int,  # ç®€å•ç›´æ¥ï¼ŒFastAPIä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºPathå‚æ•°
    db: Session = Depends(sm.get_db),
    current_user: User = Depends(get_user)
):
    pass
```

### é‡è¦æ³¨æ„äº‹é¡¹ï¼š
1. **Pathå‚æ•°è¯†åˆ«**ï¼šFastAPIä¼šè‡ªåŠ¨è¯†åˆ«URLè·¯å¾„ä¸­çš„å‚æ•°ä½œä¸ºPathå‚æ•°
2. **éªŒè¯éœ€æ±‚**ï¼šå¦‚æœä¸éœ€è¦ç‰¹æ®ŠéªŒè¯ï¼Œç›´æ¥ä½¿ç”¨ç®€å•çš„ç±»å‹æ³¨è§£å³å¯
3. **å‚æ•°é¡ºåº**ï¼šæœ‰é»˜è®¤å€¼çš„å‚æ•°å¿…é¡»æ”¾åœ¨æ— é»˜è®¤å€¼å‚æ•°ä¹‹å
4. **é¿å…æ··æ·†**ï¼šPath(...)ä¸­çš„`...`ä¸æ˜¯é»˜è®¤å€¼ï¼Œä½†Pythonè¯­æ³•è¦æ±‚å‚æ•°é¡ºåº

### æ£€æŸ¥æ¸…å•ï¼š
- âœ… Pathå‚æ•°ä½¿ç”¨ç®€å•ç±»å‹æ³¨è§£ï¼ˆæ¨èï¼‰
- âœ… å¦‚ä½¿ç”¨Path()ï¼Œç¡®ä¿æ”¾åœ¨å‚æ•°åˆ—è¡¨é€‚å½“ä½ç½®
- âœ… æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾åœ¨æ— é»˜è®¤å€¼å‚æ•°ä¹‹å
- âŒ ä¸è¦ä¸ºPathå‚æ•°è®¾ç½®é»˜è®¤å€¼è¯­æ³•
- âŒ ä¸è¦è¿åPythonå‡½æ•°å‚æ•°é¡ºåºè§„åˆ™